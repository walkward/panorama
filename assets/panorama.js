/*! panorama*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){!function(){"use strict";function b(b,d){if(this.el=b,this.$el=a(b),this.s=a.extend({},c,d),this.s.dynamic&&"undefined"!==this.s.dynamicEl&&this.s.dynamicEl.constructor===Array&&!this.s.dynamicEl.length)throw"When using dynamic mode, you must also define dynamicEl as an Array.";return this.modules={},this.lGalleryOn=!1,this.lgBusy=!1,this.hideBartimeout=!1,this.isTouch="ontouchstart"in document.documentElement,this.s.slideEndAnimatoin&&(this.s.hideControlOnEnd=!1),this.s.dynamic?this.$items=this.s.dynamicEl:"this"===this.s.selector?this.$items=this.$el:""!==this.s.selector?this.s.selectWithin?this.$items=a(this.s.selectWithin).find(this.s.selector):this.$items=this.$el.find(a(this.s.selector)):this.$items=this.$el.children(),this.$slide="",this.$outer="",this.init(),this}var c={mode:"lg-slide",cssEasing:"ease",easing:"linear",speed:600,height:"100%",width:"100%",addClass:"",startClass:"lg-start-zoom",backdropDuration:150,hideBarsDelay:6e3,useLeft:!1,closable:!0,loop:!0,escKey:!0,keyPress:!0,controls:!0,slideEndAnimatoin:!0,hideControlOnEnd:!1,mousewheel:!0,getCaptionFromTitleOrAlt:!0,appendSubHtmlTo:".lg-sub-html",subHtmlSelectorRelative:!1,preload:1,showAfterLoad:!0,selector:"",selectWithin:"",nextHtml:"",prevHtml:"",index:!1,iframeMaxWidth:"100%",download:!0,counter:!0,appendCounterTo:".lg-toolbar",swipeThreshold:50,enableSwipe:!0,enableDrag:!0,dynamic:!1,dynamicEl:[],galleryId:1};b.prototype.init=function(){var b=this;b.s.preload>b.$items.length&&(b.s.preload=b.$items.length);var c=window.location.hash;c.indexOf("lg="+this.s.galleryId)>0&&(b.index=parseInt(c.split("&slide=")[1],10),a("body").addClass("lg-from-hash"),a("body").hasClass("lg-on")||(setTimeout(function(){b.build(b.index)}),a("body").addClass("lg-on"))),b.s.dynamic?(b.$el.trigger("onBeforeOpen.lg"),b.index=b.s.index||0,a("body").hasClass("lg-on")||setTimeout(function(){b.build(b.index),a("body").addClass("lg-on")})):b.$items.on("click.lgcustom",function(c){try{c.preventDefault(),c.preventDefault()}catch(a){c.returnValue=!1}b.$el.trigger("onBeforeOpen.lg"),b.index=b.s.index||b.$items.index(this),a("body").hasClass("lg-on")||(b.build(b.index),a("body").addClass("lg-on"))})},b.prototype.build=function(b){var c=this;c.structure(),a.each(a.fn.lightGallery.modules,function(b){c.modules[b]=new a.fn.lightGallery.modules[b](c.el)}),c.slide(b,!1,!1,!1),c.s.keyPress&&c.keyPress(),c.$items.length>1&&(c.arrow(),setTimeout(function(){c.enableDrag(),c.enableSwipe()},50),c.s.mousewheel&&c.mousewheel()),c.counter(),c.closeGallery(),c.$el.trigger("onAfterOpen.lg"),c.$outer.on("mousemove.lg click.lg touchstart.lg",function(){c.$outer.removeClass("lg-hide-items"),clearTimeout(c.hideBartimeout),c.hideBartimeout=setTimeout(function(){c.$outer.addClass("lg-hide-items")},c.s.hideBarsDelay)}),c.$outer.trigger("mousemove.lg")},b.prototype.structure=function(){var b,c="",d="",e=0,f="",g=this;for(a("body").append('<div class="lg-backdrop"></div>'),a(".lg-backdrop").css("transition-duration",this.s.backdropDuration+"ms"),e=0;e<this.$items.length;e++)c+='<div class="lg-item"></div>';if(this.s.controls&&this.$items.length>1&&(d='<div class="lg-actions"><div class="lg-prev lg-icon">'+this.s.prevHtml+'</div><div class="lg-next lg-icon">'+this.s.nextHtml+"</div></div>"),".lg-sub-html"===this.s.appendSubHtmlTo&&(f='<div class="lg-sub-html"></div>'),b='<div class="lg-outer '+this.s.addClass+" "+this.s.startClass+'"><div class="lg" style="width:'+this.s.width+"; height:"+this.s.height+'"><div class="lg-inner">'+c+'</div><div class="lg-toolbar lg-group"><span class="lg-close lg-icon"></span></div>'+d+f+"</div></div>",a("body").append(b),this.$outer=a(".lg-outer"),this.$slide=this.$outer.find(".lg-item"),this.s.useLeft?(this.$outer.addClass("lg-use-left"),this.s.mode="lg-slide"):this.$outer.addClass("lg-use-css3"),g.setTop(),a(window).on("resize.lg orientationchange.lg",function(){setTimeout(function(){g.setTop()},100)}),this.$slide.eq(this.index).addClass("lg-current"),this.doCss()?this.$outer.addClass("lg-css3"):(this.$outer.addClass("lg-css"),this.s.speed=0),this.$outer.addClass(this.s.mode),this.s.enableDrag&&this.$items.length>1&&this.$outer.addClass("lg-grab"),this.s.showAfterLoad&&this.$outer.addClass("lg-show-after-load"),this.doCss()){var h=this.$outer.find(".lg-inner");h.css("transition-timing-function",this.s.cssEasing),h.css("transition-duration",this.s.speed+"ms")}setTimeout(function(){a(".lg-backdrop").addClass("in")}),setTimeout(function(){g.$outer.addClass("lg-visible")},this.s.backdropDuration),this.s.download&&this.$outer.find(".lg-toolbar").append('<a id="lg-download" target="_blank" download class="lg-download lg-icon"></a>'),this.prevScrollTop=a(window).scrollTop()},b.prototype.setTop=function(){if("100%"!==this.s.height){var b=a(window).height(),c=(b-parseInt(this.s.height,10))/2,d=this.$outer.find(".lg");b>=parseInt(this.s.height,10)?d.css("top",c+"px"):d.css("top","0px")}},b.prototype.doCss=function(){return!!function(){var a=["transition","MozTransition","WebkitTransition","OTransition","msTransition","KhtmlTransition"],b=document.documentElement,c=0;for(c=0;c<a.length;c++)if(a[c]in b.style)return!0}()},b.prototype.isVideo=function(a,b){var c;if(c=this.s.dynamic?this.s.dynamicEl[b].html:this.$items.eq(b).attr("data-html"),!a&&c)return{html5:!0};var d=a.match(/\/\/(?:www\.)?youtu(?:\.be|be\.com)\/(?:watch\?v=|embed\/)?([a-z0-9\-\_\%]+)/i),e=a.match(/\/\/(?:www\.)?vimeo.com\/([0-9a-z\-_]+)/i),f=a.match(/\/\/(?:www\.)?dai.ly\/([0-9a-z\-_]+)/i),g=a.match(/\/\/(?:www\.)?(?:vk\.com|vkontakte\.ru)\/(?:video_ext\.php\?)(.*)/i);return d?{youtube:d}:e?{vimeo:e}:f?{dailymotion:f}:g?{vk:g}:void 0},b.prototype.counter=function(){this.s.counter&&a(this.s.appendCounterTo).append('<div id="lg-counter"><span id="lg-counter-current">'+(parseInt(this.index,10)+1)+'</span> / <span id="lg-counter-all">'+this.$items.length+"</span></div>")},b.prototype.addHtml=function(b){var c,d,e=null;if(this.s.dynamic?this.s.dynamicEl[b].subHtmlUrl?c=this.s.dynamicEl[b].subHtmlUrl:e=this.s.dynamicEl[b].subHtml:(d=this.$items.eq(b),d.attr("data-sub-html-url")?c=d.attr("data-sub-html-url"):(e=d.attr("data-sub-html"),this.s.getCaptionFromTitleOrAlt&&!e&&(e=d.attr("title")||d.find("img").first().attr("alt")))),!c)if(void 0!==e&&null!==e){var f=e.substring(0,1);"."!==f&&"#"!==f||(e=this.s.subHtmlSelectorRelative&&!this.s.dynamic?d.find(e).html():a(e).html())}else e="";".lg-sub-html"===this.s.appendSubHtmlTo?c?this.$outer.find(this.s.appendSubHtmlTo).load(c):this.$outer.find(this.s.appendSubHtmlTo).html(e):c?this.$slide.eq(b).load(c):this.$slide.eq(b).append(e),void 0!==e&&null!==e&&(""===e?this.$outer.find(this.s.appendSubHtmlTo).addClass("lg-empty-html"):this.$outer.find(this.s.appendSubHtmlTo).removeClass("lg-empty-html")),this.$el.trigger("onAfterAppendSubHtml.lg",[b])},b.prototype.preload=function(a){var b=1,c=1;for(b=1;b<=this.s.preload&&!(b>=this.$items.length-a);b++)this.loadContent(a+b,!1,0);for(c=1;c<=this.s.preload&&!(a-c<0);c++)this.loadContent(a-c,!1,0)},b.prototype.loadContent=function(b,c,d){var e,f,g,h,i,j,k=this,l=!1,m=function(b){for(var c=[],d=[],e=0;e<b.length;e++){var g=b[e].split(" ");""===g[0]&&g.splice(0,1),d.push(g[0]),c.push(g[1])}for(var h=a(window).width(),i=0;i<c.length;i++)if(parseInt(c[i],10)>h){f=d[i];break}};if(k.s.dynamic){if(k.s.dynamicEl[b].poster&&(l=!0,g=k.s.dynamicEl[b].poster),j=k.s.dynamicEl[b].html,f=k.s.dynamicEl[b].src,k.s.dynamicEl[b].responsive){m(k.s.dynamicEl[b].responsive.split(","))}h=k.s.dynamicEl[b].srcset,i=k.s.dynamicEl[b].sizes}else{if(k.$items.eq(b).attr("data-poster")&&(l=!0,g=k.$items.eq(b).attr("data-poster")),j=k.$items.eq(b).attr("data-html"),f=k.$items.eq(b).attr("href")||k.$items.eq(b).attr("data-src"),k.$items.eq(b).attr("data-responsive")){m(k.$items.eq(b).attr("data-responsive").split(","))}h=k.$items.eq(b).attr("data-srcset"),i=k.$items.eq(b).attr("data-sizes")}var n=!1;k.s.dynamic?k.s.dynamicEl[b].iframe&&(n=!0):"true"===k.$items.eq(b).attr("data-iframe")&&(n=!0);var o=k.isVideo(f,b);if(!k.$slide.eq(b).hasClass("lg-loaded")){if(n)k.$slide.eq(b).prepend('<div class="lg-video-cont" style="max-width:'+k.s.iframeMaxWidth+'"><div class="lg-video"><iframe class="lg-object" frameborder="0" src="'+f+'"  allowfullscreen="true"></iframe></div></div>');else if(l){var p="";p=o&&o.youtube?"lg-has-youtube":o&&o.vimeo?"lg-has-vimeo":"lg-has-html5",k.$slide.eq(b).prepend('<div class="lg-video-cont '+p+' "><div class="lg-video"><span class="lg-video-play"></span><img class="lg-object lg-has-poster" src="'+g+'" /></div></div>')}else o?(k.$slide.eq(b).prepend('<div class="lg-video-cont "><div class="lg-video"></div></div>'),k.$el.trigger("hasVideo.lg",[b,f,j])):k.$slide.eq(b).prepend('<div class="lg-img-wrap"><img class="lg-object lg-image" src="'+f+'" /></div>');if(k.$el.trigger("onAferAppendSlide.lg",[b]),e=k.$slide.eq(b).find(".lg-object"),i&&e.attr("sizes",i),h){e.attr("srcset",h);try{picturefill({elements:[e[0]]})}catch(a){console.error("Make sure you have included Picturefill version 2")}}".lg-sub-html"!==this.s.appendSubHtmlTo&&k.addHtml(b),k.$slide.eq(b).addClass("lg-loaded")}k.$slide.eq(b).find(".lg-object").on("load.lg error.lg",function(){var c=0;d&&!a("body").hasClass("lg-from-hash")&&(c=d),setTimeout(function(){k.$slide.eq(b).addClass("lg-complete"),k.$el.trigger("onSlideItemLoad.lg",[b,d||0])},c)}),o&&o.html5&&!l&&k.$slide.eq(b).addClass("lg-complete"),!0===c&&(k.$slide.eq(b).hasClass("lg-complete")?k.preload(b):k.$slide.eq(b).find(".lg-object").on("load.lg error.lg",function(){k.preload(b)}))},b.prototype.slide=function(b,c,d,e){var f=this.$outer.find(".lg-current").index(),g=this;if(!g.lGalleryOn||f!==b){var h=this.$slide.length,i=g.lGalleryOn?this.s.speed:0;if(!g.lgBusy){if(this.s.download){var j;j=g.s.dynamic?!1!==g.s.dynamicEl[b].downloadUrl&&(g.s.dynamicEl[b].downloadUrl||g.s.dynamicEl[b].src):"false"!==g.$items.eq(b).attr("data-download-url")&&(g.$items.eq(b).attr("data-download-url")||g.$items.eq(b).attr("href")||g.$items.eq(b).attr("data-src")),j?(a("#lg-download").attr("href",j),g.$outer.removeClass("lg-hide-download")):g.$outer.addClass("lg-hide-download")}if(this.$el.trigger("onBeforeSlide.lg",[f,b,c,d]),g.lgBusy=!0,clearTimeout(g.hideBartimeout),".lg-sub-html"===this.s.appendSubHtmlTo&&setTimeout(function(){g.addHtml(b)},i),this.arrowDisable(b),e||(b<f?e="prev":b>f&&(e="next")),c){this.$slide.removeClass("lg-prev-slide lg-current lg-next-slide");var k,l;h>2?(k=b-1,l=b+1,0===b&&f===h-1?(l=0,k=h-1):b===h-1&&0===f&&(l=0,k=h-1)):(k=0,l=1),"prev"===e?g.$slide.eq(l).addClass("lg-next-slide"):g.$slide.eq(k).addClass("lg-prev-slide"),g.$slide.eq(b).addClass("lg-current")}else g.$outer.addClass("lg-no-trans"),this.$slide.removeClass("lg-prev-slide lg-next-slide"),"prev"===e?(this.$slide.eq(b).addClass("lg-prev-slide"),this.$slide.eq(f).addClass("lg-next-slide")):(this.$slide.eq(b).addClass("lg-next-slide"),this.$slide.eq(f).addClass("lg-prev-slide")),setTimeout(function(){g.$slide.removeClass("lg-current"),g.$slide.eq(b).addClass("lg-current"),g.$outer.removeClass("lg-no-trans")},50);g.lGalleryOn?(setTimeout(function(){g.loadContent(b,!0,0)},this.s.speed+50),setTimeout(function(){g.lgBusy=!1,g.$el.trigger("onAfterSlide.lg",[f,b,c,d])},this.s.speed)):(g.loadContent(b,!0,g.s.backdropDuration),g.lgBusy=!1,g.$el.trigger("onAfterSlide.lg",[f,b,c,d])),g.lGalleryOn=!0,this.s.counter&&a("#lg-counter-current").text(b+1)}}},b.prototype.goToNextSlide=function(a){var b=this,c=b.s.loop;a&&b.$slide.length<3&&(c=!1),b.lgBusy||(b.index+1<b.$slide.length?(b.index++,b.$el.trigger("onBeforeNextSlide.lg",[b.index]),b.slide(b.index,a,!1,"next")):c?(b.index=0,b.$el.trigger("onBeforeNextSlide.lg",[b.index]),b.slide(b.index,a,!1,"next")):b.s.slideEndAnimatoin&&!a&&(b.$outer.addClass("lg-right-end"),setTimeout(function(){b.$outer.removeClass("lg-right-end")},400)))},b.prototype.goToPrevSlide=function(a){var b=this,c=b.s.loop;a&&b.$slide.length<3&&(c=!1),b.lgBusy||(b.index>0?(b.index--,b.$el.trigger("onBeforePrevSlide.lg",[b.index,a]),b.slide(b.index,a,!1,"prev")):c?(b.index=b.$items.length-1,b.$el.trigger("onBeforePrevSlide.lg",[b.index,a]),b.slide(b.index,a,!1,"prev")):b.s.slideEndAnimatoin&&!a&&(b.$outer.addClass("lg-left-end"),setTimeout(function(){b.$outer.removeClass("lg-left-end")},400)))},b.prototype.keyPress=function(){var b=this;this.$items.length>1&&a(window).on("keyup.lg",function(a){b.$items.length>1&&(37===a.keyCode&&(a.preventDefault(),b.goToPrevSlide()),39===a.keyCode&&(a.preventDefault(),b.goToNextSlide()))}),a(window).on("keydown.lg",function(a){!0===b.s.escKey&&27===a.keyCode&&(a.preventDefault(),b.$outer.hasClass("lg-thumb-open")?b.$outer.removeClass("lg-thumb-open"):b.destroy())})},b.prototype.arrow=function(){var a=this;this.$outer.find(".lg-prev").on("click.lg",function(){a.goToPrevSlide()}),this.$outer.find(".lg-next").on("click.lg",function(){a.goToNextSlide()})},b.prototype.arrowDisable=function(a){!this.s.loop&&this.s.hideControlOnEnd&&(a+1<this.$slide.length?this.$outer.find(".lg-next").removeAttr("disabled").removeClass("disabled"):this.$outer.find(".lg-next").attr("disabled","disabled").addClass("disabled"),a>0?this.$outer.find(".lg-prev").removeAttr("disabled").removeClass("disabled"):this.$outer.find(".lg-prev").attr("disabled","disabled").addClass("disabled"))},b.prototype.setTranslate=function(a,b,c){this.s.useLeft?a.css("left",b):a.css({transform:"translate3d("+b+"px, "+c+"px, 0px)"})},b.prototype.touchMove=function(b,c){var d=c-b;Math.abs(d)>15&&(this.$outer.addClass("lg-dragging"),this.setTranslate(this.$slide.eq(this.index),d,0),this.setTranslate(a(".lg-prev-slide"),-this.$slide.eq(this.index).width()+d,0),this.setTranslate(a(".lg-next-slide"),this.$slide.eq(this.index).width()+d,0))},b.prototype.touchEnd=function(a){var b=this;"lg-slide"!==b.s.mode&&b.$outer.addClass("lg-slide"),this.$slide.not(".lg-current, .lg-prev-slide, .lg-next-slide").css("opacity","0"),setTimeout(function(){b.$outer.removeClass("lg-dragging"),a<0&&Math.abs(a)>b.s.swipeThreshold?b.goToNextSlide(!0):a>0&&Math.abs(a)>b.s.swipeThreshold?b.goToPrevSlide(!0):Math.abs(a)<5&&b.$el.trigger("onSlideClick.lg"),b.$slide.removeAttr("style")}),setTimeout(function(){b.$outer.hasClass("lg-dragging")||"lg-slide"===b.s.mode||b.$outer.removeClass("lg-slide")},b.s.speed+100)},b.prototype.enableSwipe=function(){var a=this,b=0,c=0,d=!1;a.s.enableSwipe&&a.isTouch&&a.doCss()&&(a.$slide.on("touchstart.lg",function(c){a.$outer.hasClass("lg-zoomed")||a.lgBusy||(c.preventDefault(),a.manageSwipeClass(),b=c.originalEvent.targetTouches[0].pageX)}),a.$slide.on("touchmove.lg",function(e){a.$outer.hasClass("lg-zoomed")||(e.preventDefault(),c=e.originalEvent.targetTouches[0].pageX,a.touchMove(b,c),d=!0)}),a.$slide.on("touchend.lg",function(){a.$outer.hasClass("lg-zoomed")||(d?(d=!1,a.touchEnd(c-b)):a.$el.trigger("onSlideClick.lg"))}))},b.prototype.enableDrag=function(){var b=this,c=0,d=0,e=!1,f=!1;b.s.enableDrag&&!b.isTouch&&b.doCss()&&(b.$slide.on("mousedown.lg",function(d){b.$outer.hasClass("lg-zoomed")||(a(d.target).hasClass("lg-object")||a(d.target).hasClass("lg-video-play"))&&(d.preventDefault(),b.lgBusy||(b.manageSwipeClass(),c=d.pageX,e=!0,b.$outer.scrollLeft+=1,b.$outer.scrollLeft-=1,b.$outer.removeClass("lg-grab").addClass("lg-grabbing"),b.$el.trigger("onDragstart.lg")))}),a(window).on("mousemove.lg",function(a){e&&(f=!0,d=a.pageX,b.touchMove(c,d),b.$el.trigger("onDragmove.lg"))}),a(window).on("mouseup.lg",function(g){f?(f=!1,b.touchEnd(d-c),b.$el.trigger("onDragend.lg")):(a(g.target).hasClass("lg-object")||a(g.target).hasClass("lg-video-play"))&&b.$el.trigger("onSlideClick.lg"),e&&(e=!1,b.$outer.removeClass("lg-grabbing").addClass("lg-grab"))}))},b.prototype.manageSwipeClass=function(){var a=this.index+1,b=this.index-1;this.s.loop&&this.$slide.length>2&&(0===this.index?b=this.$slide.length-1:this.index===this.$slide.length-1&&(a=0)),this.$slide.removeClass("lg-next-slide lg-prev-slide"),b>-1&&this.$slide.eq(b).addClass("lg-prev-slide"),this.$slide.eq(a).addClass("lg-next-slide")},b.prototype.mousewheel=function(){var a=this;a.$outer.on("mousewheel.lg",function(b){b.deltaY&&(b.deltaY>0?a.goToPrevSlide():a.goToNextSlide(),b.preventDefault())})},b.prototype.closeGallery=function(){var b=this,c=!1;this.$outer.find(".lg-close").on("click.lg",function(){b.destroy()}),b.s.closable&&(b.$outer.on("mousedown.lg",function(b){c=!!(a(b.target).is(".lg-outer")||a(b.target).is(".lg-item ")||a(b.target).is(".lg-img-wrap"))}),b.$outer.on("mouseup.lg",function(d){(a(d.target).is(".lg-outer")||a(d.target).is(".lg-item ")||a(d.target).is(".lg-img-wrap")&&c)&&(b.$outer.hasClass("lg-dragging")||b.destroy())}))},b.prototype.destroy=function(b){var c=this;b||(c.$el.trigger("onBeforeClose.lg"),a(window).scrollTop(c.prevScrollTop)),b&&(c.s.dynamic||this.$items.off("click.lg click.lgcustom"),a.removeData(c.el,"lightGallery")),this.$el.off(".lg.tm"),a.each(a.fn.lightGallery.modules,function(a){c.modules[a]&&c.modules[a].destroy()}),this.lGalleryOn=!1,clearTimeout(c.hideBartimeout),this.hideBartimeout=!1,a(window).off(".lg"),a("body").removeClass("lg-on lg-from-hash"),c.$outer&&c.$outer.removeClass("lg-visible"),a(".lg-backdrop").removeClass("in"),setTimeout(function(){c.$outer&&c.$outer.remove(),a(".lg-backdrop").remove(),b||c.$el.trigger("onCloseAfter.lg")},c.s.backdropDuration+50)},a.fn.lightGallery=function(c){return this.each(function(){if(a.data(this,"lightGallery"))try{a(this).data("lightGallery").init()}catch(a){console.error("lightGallery has not initiated properly")}else a.data(this,"lightGallery",new b(this,c))})},a.fn.lightGallery.modules={}}()}),window.libpannellum=function(a,b,c){function d(d){function j(a,b){return 1==a.level&&1!=b.level?-1:1==b.level&&1!=a.level?1:b.timestamp-a.timestamp}function k(a,b){return a.level!=b.level?a.level-b.level:a.diff-b.diff}function l(a,b,c,d,e,f){this.vertices=a,this.side=b,this.level=c,this.x=d,this.y=e,this.path=f.replace("%s",b).replace("%l",c).replace("%x",d).replace("%y",e)}function m(a,b,c,d,e){var f,g=b.vertices;f=r(a,g.slice(0,3));var h=r(a,g.slice(3,6)),i=r(a,g.slice(6,9)),g=r(a,g.slice(9,12)),j=f[0]+h[0]+i[0]+g[0];if(-4==j||4==j?f=!1:(j=f[1]+h[1]+i[1]+g[1],f=-4!=j&&4!=j&&4!=f[2]+h[2]+i[2]+g[2]),f){for(f=b.vertices,h=f[0]+f[3]+f[6]+f[9],i=f[1]+f[4]+f[7]+f[10],g=f[2]+f[5]+f[8]+f[11],j=Math.sqrt(h*h+i*i+g*g),g=Math.asin(g/j),h=Math.atan2(i,h)-d,h+=h>Math.PI?-2*Math.PI:h<-Math.PI?2*Math.PI:0,h=Math.abs(h),b.diff=Math.acos(Math.sin(c)*Math.sin(g)+Math.cos(c)*Math.cos(g)*Math.cos(h)),h=!1,i=0;i<t.nodeCache.length;i++)if(t.nodeCache[i].path==b.path){h=!0,t.nodeCache[i].timestamp=t.nodeCacheTimestamp++,t.nodeCache[i].diff=b.diff,t.currentNodes.push(t.nodeCache[i]);break}if(h||(b.timestamp=t.nodeCacheTimestamp++,t.currentNodes.push(b),t.nodeCache.push(b)),b.level<t.level){var g=B.cubeResolution*Math.pow(2,b.level-B.maxLevel),h=Math.ceil(g*B.invTileResolution)-1,i=g%B.tileResolution*2,k=2*g%B.tileResolution;0===k&&(k=B.tileResolution),0===i&&(i=2*B.tileResolution),j=.5,b.x!=h&&b.y!=h||(j=1-B.tileResolution/(B.tileResolution+k));var n=1-j,g=[],o=j,p=j,q=j,s=n,u=n,v=n;for(k<B.tileResolution&&(b.x==h&&b.y!=h?(u=p=.5,("d"==b.side||"u"==b.side)&&(v=q=.5)):b.x!=h&&b.y==h&&(s=o=.5,"l"==b.side||"r"==b.side)&&(v=q=.5)),i<=B.tileResolution&&(b.x==h&&(o=0,s=1,"l"==b.side||"r"==b.side)&&(q=0,v=1),b.y==h&&(p=0,u=1,"d"==b.side||"u"==b.side)&&(q=0,v=1)),k=[f[0],f[1],f[2],f[0]*o+f[3]*s,f[1]*j+f[4]*n,f[2]*q+f[5]*v,f[0]*o+f[6]*s,f[1]*p+f[7]*u,f[2]*q+f[8]*v,f[0]*j+f[9]*n,f[1]*p+f[10]*u,f[2]*q+f[11]*v],k=new l(k,b.side,b.level+1,2*b.x,2*b.y,B.fullpath),g.push(k),b.x==h&&i<=B.tileResolution||(k=[f[0]*o+f[3]*s,f[1]*j+f[4]*n,f[2]*q+f[5]*v,f[3],f[4],f[5],f[3]*j+f[6]*n,f[4]*p+f[7]*u,f[5]*q+f[8]*v,f[0]*o+f[6]*s,f[1]*p+f[7]*u,f[2]*q+f[8]*v],k=new l(k,b.side,b.level+1,2*b.x+1,2*b.y,B.fullpath),g.push(k)),b.x==h&&i<=B.tileResolution||b.y==h&&i<=B.tileResolution||(k=[f[0]*o+f[6]*s,f[1]*p+f[7]*u,f[2]*q+f[8]*v,f[3]*j+f[6]*n,f[4]*p+f[7]*u,f[5]*q+f[8]*v,f[6],f[7],f[8],f[9]*o+f[6]*s,f[10]*j+f[7]*n,f[11]*q+f[8]*v],k=new l(k,b.side,b.level+1,2*b.x+1,2*b.y+1,B.fullpath),g.push(k)),b.y==h&&i<=B.tileResolution||(k=[f[0]*j+f[9]*n,f[1]*p+f[10]*u,f[2]*q+f[11]*v,f[0]*o+f[6]*s,f[1]*p+f[7]*u,f[2]*q+f[8]*v,f[9]*o+f[6]*s,f[10]*j+f[7]*n,f[11]*q+f[8]*v,f[9],f[10],f[11]],k=new l(k,b.side,b.level+1,2*b.x,2*b.y+1,B.fullpath),g.push(k)),b=0;b<g.length;b++)m(a,g[b],c,d,e)}}}function n(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function o(a,b,c){var d=Math.sin(b);return b=Math.cos(b),"x"==c?[a[0],b*a[1]+d*a[2],b*a[2]-d*a[1],a[3],b*a[4]+d*a[5],b*a[5]-d*a[4],a[6],b*a[7]+d*a[8],b*a[8]-d*a[7]]:"y"==c?[b*a[0]-d*a[2],a[1],b*a[2]+d*a[0],b*a[3]-d*a[5],a[4],b*a[5]+d*a[3],b*a[6]-d*a[8],a[7],b*a[8]+d*a[6]]:"z"==c?[b*a[0]+d*a[1],b*a[1]-d*a[0],a[2],b*a[3]+d*a[4],b*a[4]-d*a[3],a[5],b*a[6]+d*a[7],b*a[7]-d*a[6],a[8]]:void 0}function p(a){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]]}function q(a){a.textureLoad||(a.textureLoad=!0,I(encodeURI(a.path+"."+B.extension),function(b){a.texture=b,a.textureLoaded=!0}))}function r(a,b){var c=[a[0]*b[0]+a[1]*b[1]+a[2]*b[2],a[4]*b[0]+a[5]*b[1]+a[6]*b[2],a[11]+a[8]*b[0]+a[9]*b[1]+a[10]*b[2],1/(a[12]*b[0]+a[13]*b[1]+a[14]*b[2])],d=c[0]*c[3],e=c[1]*c[3],c=c[2]*c[3],f=[0,0,0];return-1>d&&(f[0]=-1),1<d&&(f[0]=1),-1>e&&(f[1]=-1),1<e&&(f[1]=1),(-1>c||1<c)&&(f[2]=1),f}var s=b.createElement("canvas");s.style.width=s.style.height="100%",d.appendChild(s);var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;this.init=function(a,j,k,l,m,o,p,q){if(typeof j===c&&(j="equirectangular"),C=j,B=a,D=k,t){if(v&&(u.detachShader(t,v),u.deleteShader(v)),w&&(u.detachShader(t,w),u.deleteShader(w)),u.bindBuffer(u.ARRAY_BUFFER,null),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null),t.texture&&u.deleteTexture(t.texture),t.nodeCache)for(a=0;a<t.nodeCache.length;a++)u.deleteTexture(t.nodeCache[a].texture);u.deleteProgram(t),t=c}if(A=c,"cubemap"==C&&0!=(B[0].width&B[0].width-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||u||(u=s.getContext("experimental-webgl",{alpha:!1,depth:!1})),!u&&("multires"==C&&B.hasOwnProperty("fallbackPath")||"cubemap"==C)&&("WebkitAppearance"in b.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){y&&d.removeChild(y),y=b.createElement("div"),y.className="pnlm-world",l=B.basePath?B.basePath+B.fallbackPath:B.fallbackPath;var r="frblud".split(""),I=0;for(m=function(){var a=b.createElement("canvas");a.className="pnlm-face pnlm-"+r[this.side]+"face",y.appendChild(a);var c=a.getContext("2d");a.style.width=this.width+4+"px",a.style.height=this.height+4+"px",a.width=this.width+4,a.height=this.height+4,c.drawImage(this,2,2);var e,f,g=c.getImageData(0,0,a.width,a.height),h=g.data;for(e=2;e<a.width-2;e++)for(f=0;4>f;f++)h[4*(e+a.width)+f]=h[4*(e+2*a.width)+f],h[4*(e+a.width*(a.height-2))+f]=h[4*(e+a.width*(a.height-3))+f];for(e=2;e<a.height-2;e++)for(f=0;4>f;f++)h[4*(e*a.width+1)+f]=h[4*(e*a.width+2)+f],h[4*((e+1)*a.width-2)+f]=h[4*((e+1)*a.width-3)+f];for(f=0;4>f;f++)h[4*(a.width+1)+f]=h[4*(2*a.width+2)+f],h[4*(2*a.width-2)+f]=h[4*(3*a.width-3)+f],h[4*(a.width*(a.height-2)+1)+f]=h[4*(a.width*(a.height-3)+2)+f],h[4*(a.width*(a.height-1)-2)+f]=h[4*(a.width*(a.height-2)-3)+f];for(e=1;e<a.width-1;e++)for(f=0;4>f;f++)h[4*e+f]=h[4*(e+a.width)+f],h[4*(e+a.width*(a.height-1))+f]=h[4*(e+a.width*(a.height-2))+f];for(e=1;e<a.height-1;e++)for(f=0;4>f;f++)h[e*a.width*4+f]=h[4*(e*a.width+1)+f],h[4*((e+1)*a.width-1)+f]=h[4*((e+1)*a.width-2)+f];for(f=0;4>f;f++)h[f]=h[4*(a.width+1)+f],h[4*(a.width-1)+f]=h[4*(2*a.width-2)+f],h[a.width*(a.height-1)*4+f]=h[4*(a.width*(a.height-2)+1)+f],h[4*(a.width*a.height-1)+f]=h[4*(a.width*(a.height-1)-2)+f];c.putImageData(g,0,0),6==++I&&(x=this.width,d.appendChild(y),p())},a=0;6>a;a++)o=new Image,o.crossOrigin="anonymous",o.side=a,o.onload=m,o.src="multires"==C?encodeURI(l.replace("%s",r[a])+"."+B.extension):encodeURI(B[a].src)}else{if(!u)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for(B.fullpath=B.basePath?B.basePath+B.path:B.path,B.invTileResolution=1/B.tileResolution,j=n(),z=[],a=0;6>a;a++)z[a]=j.slice(12*a,12*a+12),j=n();if("equirectangular"==C){if(a=Math.max(B.width,B.height),j=u.getParameter(u.MAX_TEXTURE_SIZE),a>j)throw console.log("Error: The image is too big; it's "+a+"px wide, but this device's maximum supported width is "+j+"px."),{type:"webgl size error",width:a,maxWidth:j}}else if("cubemap"==C&&(a=B[0].width,j=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),a>j))throw console.log("Error: The cube face image is too big; it's "+a+"px wide, but this device's maximum supported width is "+j+"px."),{type:"webgl size error",width:a,maxWidth:j};if(q===c||q.horizonPitch===c&&q.horizonRoll===c||(A=[q.horizonPitch==c?0:q.horizonPitch,q.horizonRoll==c?0:q.horizonRoll]),a=u.TEXTURE_2D,u.viewport(0,0,s.width,s.height),v=u.createShader(u.VERTEX_SHADER),j=e,"multires"==C&&(j=f),u.shaderSource(v,j),u.compileShader(v),w=u.createShader(u.FRAGMENT_SHADER),j=h,"cubemap"==C?(a=u.TEXTURE_CUBE_MAP,j=g):"multires"==C&&(j=i),u.shaderSource(w,j),u.compileShader(w),t=u.createProgram(),u.attachShader(t,v),u.attachShader(t,w),u.linkProgram(t),u.getShaderParameter(v,u.COMPILE_STATUS)||console.log(u.getShaderInfoLog(v)),u.getShaderParameter(w,u.COMPILE_STATUS)||console.log(u.getShaderInfoLog(w)),u.getProgramParameter(t,u.LINK_STATUS)||console.log(u.getProgramInfoLog(t)),u.useProgram(t),t.drawInProgress=!1,t.texCoordLocation=u.getAttribLocation(t,"a_texCoord"),u.enableVertexAttribArray(t.texCoordLocation),"multires"!=C?(E||(E=u.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,E),u.bufferData(u.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),u.STATIC_DRAW),u.vertexAttribPointer(t.texCoordLocation,2,u.FLOAT,!1,0,0),t.aspectRatio=u.getUniformLocation(t,"u_aspectRatio"),u.uniform1f(t.aspectRatio,s.width/s.height),t.psi=u.getUniformLocation(t,"u_psi"),t.theta=u.getUniformLocation(t,"u_theta"),t.f=u.getUniformLocation(t,"u_f"),t.h=u.getUniformLocation(t,"u_h"),t.v=u.getUniformLocation(t,"u_v"),t.vo=u.getUniformLocation(t,"u_vo"),t.rot=u.getUniformLocation(t,"u_rot"),u.uniform1f(t.h,l/(2*Math.PI)),u.uniform1f(t.v,m/Math.PI),u.uniform1f(t.vo,o/Math.PI*2),"equirectangular"==C&&(t.backgroundColor=u.getUniformLocation(t,"u_backgroundColor"),u.uniform4fv(t.backgroundColor,(q.backgroundColor?q.backgroundColor:[0,0,0]).concat([1]))),t.texture=u.createTexture(),u.bindTexture(a,t.texture),"cubemap"==C?(u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[1]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_X,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[3]),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Y,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[4]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[5]),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Z,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[0]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B[2])):u.texImage2D(a,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B),u.texParameteri(a,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(a,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(a,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(a,u.TEXTURE_MAG_FILTER,u.LINEAR)):(t.vertPosLocation=u.getAttribLocation(t,"a_vertCoord"),u.enableVertexAttribArray(t.vertPosLocation),F||(F=u.createBuffer()),G||(G=u.createBuffer()),H||(H=u.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,G),u.bufferData(u.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,H),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),u.STATIC_DRAW),t.perspUniform=u.getUniformLocation(t,"u_perspMatrix"),t.cubeUniform=u.getUniformLocation(t,"u_cubeMatrix"),t.level=-1,t.currentNodes=[],t.nodeCache=[],t.nodeCacheTimestamp=0),0!==u.getError())throw console.log("Error: Something went wrong with WebGL!"),{type:"webgl error"};p()}},this.destroy=function(){if(d!==c&&(s!==c&&d.removeChild(s),y!==c&&d.removeChild(y)),u){var a=u.getExtension("WEBGL_lose_context");a&&a.loseContext()}},this.resize=function(){var b=a.devicePixelRatio||1;s.width=s.clientWidth*b,s.height=s.clientHeight*b,u&&(u.viewport(0,0,s.width,s.height),"multires"!=C&&u.uniform1f(t.aspectRatio,s.width/s.height))},this.resize(),this.render=function(b,d,e,f){var g;if(g=0,f===c&&(f={}),f.roll&&(g=f.roll),A!==c){var h=A[0],i=A[1],n=b,r=d,v=Math.cos(i)*Math.sin(b)*Math.sin(h)+Math.cos(b)*(Math.cos(h)*Math.cos(d)+Math.sin(i)*Math.sin(h)*Math.sin(d)),w=-Math.sin(b)*Math.sin(i)+Math.cos(b)*Math.cos(i)*Math.sin(d);b=Math.cos(i)*Math.cos(h)*Math.sin(b)+Math.cos(b)*(-Math.cos(d)*Math.sin(h)+Math.cos(h)*Math.sin(i)*Math.sin(d)),b=Math.asin(Math.max(Math.min(b,1),-1)),d=Math.atan2(w,v),h=[Math.cos(n)*(Math.sin(i)*Math.sin(h)*Math.cos(r)-Math.cos(h)*Math.sin(r)),Math.cos(n)*Math.cos(i)*Math.cos(r),Math.cos(n)*(Math.cos(h)*Math.sin(i)*Math.cos(r)+Math.sin(r)*Math.sin(h))],i=[-Math.cos(b)*Math.sin(d),Math.cos(b)*Math.cos(d)],i=Math.acos(Math.max(Math.min((h[0]*i[0]+h[1]*i[1])/(Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*Math.sqrt(i[0]*i[0]+i[1]*i[1])),1),-1)),0>h[2]&&(i=2*Math.PI-i),g+=i}if(u||"multires"!=C&&"cubemap"!=C){if("multires"!=C)e=2*Math.atan(Math.tan(.5*e)/(s.width/s.height)),e=1/Math.tan(.5*e),u.uniform1f(t.psi,d),u.uniform1f(t.theta,b),u.uniform1f(t.rot,g),u.uniform1f(t.f,e),!0===D&&"equirectangular"==C&&(u.bindTexture(u.TEXTURE_2D,t.texture),u.texImage2D(u.TEXTURE_2D,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,B)),u.drawArrays(u.TRIANGLES,0,6);else{for(h=s.width/s.height,i=2*Math.atan(Math.tan(e/2)*s.height/s.width),i=1/Math.tan(i/2),h=[i/h,0,0,0,0,i,0,0,0,0,100.1/-99.9,20/-99.9,0,0,-1,0],i=1;i<B.maxLevel&&s.width>B.tileResolution*Math.pow(2,i-1)*Math.tan(e/2)*.707;)i++;if(t.level=i,i=[1,0,0,0,1,0,0,0,1],i=o(i,-g,"z"),i=o(i,-b,"x"),i=o(i,d,"y"),i=[i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1],u.uniformMatrix4fv(t.perspUniform,!1,new Float32Array(p(h))),u.uniformMatrix4fv(t.cubeUniform,!1,new Float32Array(p(i))),h=[h[0]*i[0],h[0]*i[1],h[0]*i[2],0,h[5]*i[4],h[5]*i[5],h[5]*i[6],0,h[10]*i[8],h[10]*i[9],h[10]*i[10],h[11],-i[8],-i[9],-i[10],0],t.nodeCache.sort(j),200<t.nodeCache.length&&t.nodeCache.length>t.currentNodes.length+50)for(i=t.nodeCache.splice(200,t.nodeCache.length-200),g=0;g<i.length;g++)u.deleteTexture(i[g].texture);for(t.currentNodes=[],i="fbudlr".split(""),g=0;6>g;g++)n=new l(z[g],i[g],1,0,0,B.fullpath),m(h,n,b,d,e);for(t.currentNodes.sort(k),g=0;g<t.currentNodes.length;g++)if(!t.currentNodes[g].texture){setTimeout(q(t.currentNodes[g]),0);break}if(!t.drawInProgress){for(t.drawInProgress=!0,b=0;b<t.currentNodes.length;b++)t.currentNodes[b].textureLoaded&&(u.bindBuffer(u.ARRAY_BUFFER,F),u.bufferData(u.ARRAY_BUFFER,new Float32Array(t.currentNodes[b].vertices),u.STATIC_DRAW),u.vertexAttribPointer(t.vertPosLocation,3,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,G),u.vertexAttribPointer(t.texCoordLocation,2,u.FLOAT,!1,0,0),u.bindTexture(u.TEXTURE_2D,t.currentNodes[b].texture),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0));t.drawInProgress=!1}}if(f.returnImage!==c)return s.toDataURL("image/png")}else for(g=x/2,f={f:"translate3d(-"+(g+2)+"px, -"+(g+2)+"px, -"+g+"px)",b:"translate3d("+(g+2)+"px, -"+(g+2)+"px, "+g+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(g+2)+"px, -"+g+"px, "+(g+2)+"px) rotateX(270deg)",d:"translate3d(-"+(g+2)+"px, "+g+"px, -"+(g+2)+"px) rotateX(90deg)",l:"translate3d(-"+g+"px, -"+(g+2)+"px, "+(g+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+g+"px, -"+(g+2)+"px, -"+(g+2)+"px) rotateY(270deg)"},e=1/Math.tan(e/2),e=e*s.width/(a.devicePixelRatio||1)/2+"px",b="perspective("+e+") translateZ("+e+") rotateX("+b+"rad) rotateY("+d+"rad) ",d=Object.keys(f),g=0;6>g;g++)e=y.querySelector(".pnlm-"+d[g]+"face").style,e.webkitTransform=b+f[d[g]],e.transform=b+f[d[g]]},this.isLoading=function(){if(u&&"multires"==C)for(var a=0;a<t.currentNodes.length;a++)if(!t.currentNodes[a].textureLoaded)return!0;return!1},this.getCanvas=function(){return s};var I=function(){function a(){var a=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin="anonymous",this.image.addEventListener("load",function(){var b=a.image;u.bindTexture(u.TEXTURE_2D,a.texture),u.texImage2D(u.TEXTURE_2D,0,u.RGB,u.RGB,u.UNSIGNED_BYTE,b),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.bindTexture(u.TEXTURE_2D,null),a.callback(a.texture),e.length?(b=e.shift(),a.loadTexture(b.src,b.texture,b.callback)):d[c++]=a})}function b(a,b,c){this.src=a,this.texture=b,this.callback=c}var c=4,d={},e=[];a.prototype.loadTexture=function(a,b,c){this.texture=b,this.callback=c,this.image.src=a};for(var f=0;f<c;f++)d[f]=new a;return function(a,f){var g=u.createTexture();return c?d[--c].loadTexture(a,g,f):e.push(new b(a,g,f)),g}}()}var e="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",f="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",g="precision mediump float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",h="precision mediump float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse\ngl_FragColor = texture2D(u_image, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}",i="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(a,b,c,e){return new d(a,b,c,e)}}}(window,document),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}()),window.pannellum=function(a,b,c){function d(d,e){function f(){var e=b.createElement("div");if(e.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1==e.getElementsByTagName("i").length)j();else{ga=aa.hfov,ha=aa.pitch;var f;if("cubemap"==aa.type){for(da=[],e=0;6>e;e++)da.push(new Image),da[e].crossOrigin="anonymous";Ia.load.lbox.style.display="block",Ia.load.lbar.style.display="none"}else if("multires"==aa.type)e=JSON.parse(JSON.stringify(aa.multiRes)),aa.basePath&&aa.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(aa.multiRes.basePath)?e.basePath=aa.basePath+aa.multiRes.basePath:aa.multiRes.basePath?e.basePath=aa.multiRes.basePath:aa.basePath&&(e.basePath=aa.basePath),da=e;else if(!0===aa.dynamic)da=aa.panorama;else{if(aa.panorama===c)return void j("No panorama image was specified.");da=new Image}if("cubemap"==aa.type)for(var k=6,l=function(){0===--k&&h()},m=function(a){var c=b.createElement("a");c.href=a.target.src,c.innerHTML=c.href,j("The file "+c.outerHTML+" could not be accessed.")},e=0;e<da.length;e++)da[e].onload=l,da[e].onerror=m,f=aa.cubeMap[e],aa.basePath&&!g(f)&&(f=aa.basePath+f),da[e].src=encodeURI(f);else if("multires"==aa.type)h();else if(f="",aa.basePath&&(f=aa.basePath),!0!==aa.dynamic){f=g(aa.panorama)?aa.panorama:f+aa.panorama,da.onload=function(){a.URL.revokeObjectURL(this.src),h()};var n=new XMLHttpRequest;n.onloadend=function(){if(200!=n.status){var a=b.createElement("a");a.href=encodeURI(f),a.innerHTML=a.href,j("The file "+a.outerHTML+" could not be accessed.")}i(this.response),Ia.load.msg.innerHTML=""},n.onprogress=function(a){if(a.lengthComputable){Ia.load.lbarFill.style.width=a.loaded/a.total*100+"%";var b,c;1e6<a.total?(b="MB",c=(a.loaded/1e6).toFixed(2),a=(a.total/1e6).toFixed(2)):1e3<a.total?(b="kB",c=(a.loaded/1e3).toFixed(1),a=(a.total/1e3).toFixed(1)):(b="B",c=a.loaded,a=a.total),Ia.load.msg.innerHTML=c+" / "+a+" "+b}else Ia.load.lbox.style.display="block",Ia.load.lbar.style.display="none"};try{n.open("GET",f,!0)}catch(a){j("There is something wrong with the panorama URL.")}n.responseType="blob",n.setRequestHeader("Accept","image/*,*/*;q=0.9"),n.send()}d.classList.add("pnlm-grab"),d.classList.remove("pnlm-grabbing")}}function g(a){return/^(?:[a-z]+:)?\/\//i.test(a)||"/"==a[0]||"blob:"==a.slice(0,5)}function h(){ba||(ba=new libpannellum.renderer(Fa)),ua||(ua=!0,Ga.addEventListener("mousedown",m,!1),b.addEventListener("mousemove",o,!1),b.addEventListener("mouseup",p,!1),aa.mouseZoom&&(d.addEventListener("mousewheel",w,!1),d.addEventListener("DOMMouseScroll",w,!1)),d.addEventListener("mozfullscreenchange",S,!1),d.addEventListener("webkitfullscreenchange",S,!1),d.addEventListener("msfullscreenchange",S,!1),d.addEventListener("fullscreenchange",S,!1),a.addEventListener("resize",D,!1),a.addEventListener("orientationchange",D,!1),d.addEventListener("keydown",x,!1),d.addEventListener("keyup",z,!1),d.addEventListener("blur",y,!1),b.addEventListener("mouseleave",p,!1),Ga.addEventListener("touchstart",q,!1),Ga.addEventListener("touchmove",r,!1),Ga.addEventListener("touchend",s,!1),Ga.addEventListener("pointerdown",t,!1),Ga.addEventListener("pointermove",u,!1),Ga.addEventListener("pointerup",v,!1),Ga.addEventListener("pointerleave",v,!1),a.navigator.pointerEnabled&&(d.style.touchAction="none")),J(),setTimeout(function(){},500)}function i(b){var d=new FileReader;d.addEventListener("loadend",function(){var e=d.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var f=e.indexOf("ÿÂ");(0>f||65536<f)&&j("Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).")}if(-1<(f=e.indexOf("<x:xmpmeta"))&&!0!==aa.ignoreGPanoXMP){var g=e.substring(f,e.indexOf("</x:xmpmeta>")+12),h=function(a){var b;return 0<=g.indexOf(a+'="')?(b=g.substring(g.indexOf(a+'="')+a.length+2),b=b.substring(0,b.indexOf('"'))):0<=g.indexOf(a+">")&&(b=g.substring(g.indexOf(a+">")+a.length+1),b=b.substring(0,b.indexOf("<"))),b!==c?Number(b):null},e=h("GPano:FullPanoWidthPixels"),f=h("GPano:CroppedAreaImageWidthPixels"),i=h("GPano:FullPanoHeightPixels"),k=h("GPano:CroppedAreaImageHeightPixels"),l=h("GPano:CroppedAreaTopPixels"),m=h("GPano:PoseHeadingDegrees"),n=h("GPano:PosePitchDegrees"),h=h("GPano:PoseRollDegrees");null!==e&&null!==f&&null!==i&&null!==k&&null!==l&&(0>Ba.indexOf("haov")&&(aa.haov=f/e*360),0>Ba.indexOf("vaov")&&(aa.vaov=k/i*180),0>Ba.indexOf("vOffset")&&(aa.vOffset=-180*((l+k/2)/i-.5)),null!==m&&0>Ba.indexOf("northOffset")&&(aa.northOffset=m,!1!==aa.compass&&(aa.compass=!0)),null!==n&&null!==h&&(0>Ba.indexOf("horizonPitch")&&(aa.horizonPitch=n),0>Ba.indexOf("horizonRoll")&&(aa.horizonRoll=h)))}da.src=a.URL.createObjectURL(b)}),d.readAsBinaryString!==c?d.readAsBinaryString(b):d.readAsText(b)}function j(a){a===c&&(a="Your browser does not have the necessary WebGL support to display this panorama."),Ia.errorMsg.innerHTML="<p>"+a+"</p>",Ka.load.style.display="none",Ia.load.box.style.display="none",Ia.errorMsg.style.display="table",ta=!0,Fa.style.display="none",_("error",a)}function k(a){var b=l(a);Ha.style.left=b.x+"px",Ha.style.top=b.y+"px",clearTimeout(k.t1),clearTimeout(k.t2),Ha.style.display="block",Ha.style.opacity=1,k.t1=setTimeout(function(){Ha.style.opacity=0},2e3),k.t2=setTimeout(function(){Ha.style.display="none"},2500),a.preventDefault()}function l(a){var b=d.getBoundingClientRect(),c={};return c.x=a.clientX-b.left,c.y=a.clientY-b.top,c}function m(a){if(a.preventDefault(),d.focus(),sa){var b=l(a);if(aa.hotSpotDebug){var c=n(a);console.log("Pitch: "+c[0]+", Yaw: "+c[1]+", Center Pitch: "+aa.pitch+", Center Yaw: "+aa.yaw+", HFOV: "+aa.hfov)}V(),Y(),aa.roll=0,va.hfov=0,ja=!0,ka=Date.now(),la=b.x,ma=b.y,oa=aa.yaw,pa=aa.pitch,d.classList.add("pnlm-grabbing"),d.classList.remove("pnlm-grab"),_("mousedown",a),E()}}function n(b){var c=l(b);b=ba.getCanvas();var d=b.width/(a.devicePixelRatio||1),e=b.height/(a.devicePixelRatio||1);b=c.x/d*2-1;var e=(1-c.y/e*2)*e/d,f=1/Math.tan(aa.hfov*Math.PI/360),g=Math.sin(aa.pitch*Math.PI/180),h=Math.cos(aa.pitch*Math.PI/180),c=f*h-e*g,d=Math.sqrt(b*b+c*c),e=180*Math.atan((e*h+f*g)/d)/Math.PI;return b=180*Math.atan2(b/d,c/d)/Math.PI+aa.yaw,[e,b]}function o(b){if(ja&&sa){ka=Date.now();var c=ba.getCanvas(),d=c.width/(a.devicePixelRatio||1),c=c.height/(a.devicePixelRatio||1);b=l(b);var e=180*(Math.atan(la/d*2-1)-Math.atan(b.x/d*2-1))/Math.PI*aa.hfov/90+oa;va.yaw=(e-aa.yaw)%360*.2,aa.yaw=e,d=360*Math.atan(Math.tan(aa.hfov/360*Math.PI)*c/d)/Math.PI,d=180*(Math.atan(b.y/c*2-1)-Math.atan(ma/c*2-1))/Math.PI*d/90+pa,va.pitch=.2*(d-aa.pitch),aa.pitch=d}}function p(a){ja&&(ja=!1,15<Date.now()-ka&&(va.pitch=va.yaw=0),d.classList.add("pnlm-grab"),d.classList.remove("pnlm-grabbing"),ka=Date.now(),_("mouseup",a))}function q(a){if(sa){V(),Y(),aa.roll=0,va.hfov=0;var b=l(a.targetTouches[0]);la=b.x,ma=b.y,2==a.targetTouches.length&&(a=l(a.targetTouches[1]),la+=.5*(a.x-b.x),ma+=.5*(a.y-b.y),na=Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))),ja=!0,ka=Date.now(),oa=aa.yaw,pa=aa.pitch,E()}}function r(a){if(a.preventDefault(),sa&&(ka=Date.now()),ja&&sa){var b=l(a.targetTouches[0]),c=b.x,d=b.y;2==a.targetTouches.length&&-1!=na&&(a=l(a.targetTouches[1]),c+=.5*(a.x-b.x),d+=.5*(a.y-b.y),b=Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)),U(aa.hfov+.1*(na-b)),na=b),b=aa.hfov/360,c=(la-c)*b+oa,va.yaw=(c-aa.yaw)%360*.2,aa.yaw=c,d=(d-ma)*b+pa,va.pitch=.2*(d-aa.pitch),aa.pitch=d}}function s(){ja=!1,150<Date.now()-ka&&(va.pitch=va.yaw=0),na=-1,ka=Date.now()}function t(a){"touch"==a.pointerType&&(Ma.push(a.pointerId),Na.push({clientX:a.clientX,clientY:a.clientY}),a.targetTouches=Na,q(a),a.preventDefault())}function u(a){if("touch"==a.pointerType)for(var b=0;b<Ma.length;b++)if(a.pointerId==Ma[b]){Na[b]={clientX:a.clientX,clientY:a.clientY},a.targetTouches=Na,r(a);break}}function v(a){if("touch"==a.pointerType){for(var b=!1,d=0;d<Ma.length;d++)a.pointerId==Ma[d]&&(Ma[d]=c),Ma[d]&&(b=!0);b||(Ma=[],Na=[],s()),a.preventDefault()}}function w(a){a.preventDefault(),sa&&(V(),ka=Date.now(),a.wheelDeltaY?(U(aa.hfov-.05*a.wheelDeltaY),va.hfov=0>a.wheelDelta?1:-1):a.wheelDelta?(U(aa.hfov-.05*a.wheelDelta),va.hfov=0>a.wheelDelta?1:-1):a.detail&&(U(aa.hfov+1.5*a.detail),va.hfov=0<a.detail?1:-1),E())}function x(a){a.preventDefault(),V(),ka=Date.now(),Y(),aa.roll=0;var b=a.keycode;a.which&&(b=a.which),27==b?ra&&R():A(b,!0)}function y(){for(var a=0;10>a;a++)qa[a]=!1}function z(a){a.preventDefault();var b=a.keycode;a.which&&(b=a.which),A(b,!1)}function A(a,b){var c=!1;switch(a){case 109:case 189:case 17:qa[0]!=b&&(c=!0),qa[0]=b;break;case 107:case 187:case 16:qa[1]!=b&&(c=!0),qa[1]=b;break;case 38:qa[2]!=b&&(c=!0),qa[2]=b;break;case 87:qa[6]!=b&&(c=!0),qa[6]=b;break;case 40:qa[3]!=b&&(c=!0),qa[3]=b;break;case 83:qa[7]!=b&&(c=!0),qa[7]=b;break;case 37:qa[4]!=b&&(c=!0),qa[4]=b;break;case 65:qa[8]!=b&&(c=!0),qa[8]=b;break;case 39:qa[5]!=b&&(c=!0),qa[5]=b;break;case 68:qa[9]!=b&&(c=!0),qa[9]=b}c&&b&&(ea="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),E())}function B(){if(sa){var a,b=!1,d=aa.pitch,e=aa.yaw,f=aa.hfov;a="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ea===c&&(ea=a);var g=(a-ea)*aa.hfov/1700,g=Math.min(g,1);if(qa[0]&&!0===aa.keyboardZoom&&(U(aa.hfov+(.8*va.hfov+.5)*g),b=!0),qa[1]&&!0===aa.keyboardZoom&&(U(aa.hfov+(.8*va.hfov-.2)*g),b=!0),(qa[2]||qa[6])&&(aa.pitch+=(.8*va.pitch+.2)*g,b=!0),(qa[3]||qa[7])&&(aa.pitch+=(.8*va.pitch-.2)*g,b=!0),(qa[4]||qa[8])&&(aa.yaw+=(.8*va.yaw-.2)*g,b=!0),(qa[5]||qa[9])&&(aa.yaw+=(.8*va.yaw+.2)*g,b=!0),b&&(ka=Date.now()),Date.now(),aa.autoRotate){if(.001<a-ea){var b=(a-ea)/1e3,h=(va.yaw/b*g-.2*aa.autoRotate)*b,h=(0<-aa.autoRotate?1:-1)*Math.min(Math.abs(aa.autoRotate*b),Math.abs(h));aa.yaw+=h}aa.autoRotateStopDelay&&(aa.autoRotateStopDelay-=a-ea,0>=aa.autoRotateStopDelay&&(aa.autoRotateStopDelay=!1,ya=aa.autoRotate,aa.autoRotate=0))}za.pitch&&(C("pitch"),d=aa.pitch),za.yaw&&(C("yaw"),e=aa.yaw),za.hfov&&(C("hfov"),f=aa.hfov),0<g&&!aa.autoRotate&&(qa[4]||qa[5]||qa[8]||qa[9]||za.yaw||(aa.yaw+=va.yaw*g*.85),qa[2]||qa[3]||qa[6]||qa[7]||za.pitch||(aa.pitch+=va.pitch*g*.85),qa[0]||qa[1]||za.hfov||U(aa.hfov+va.hfov*g*.85)),ea=a,0<g&&(va.yaw=.8*va.yaw+(aa.yaw-e)/g*.2,va.pitch=.8*va.pitch+(aa.pitch-d)/g*.2,va.hfov=.8*va.hfov+(aa.hfov-f)/g*.2,d=aa.autoRotate?Math.abs(aa.autoRotate):5,va.yaw=Math.min(d,Math.max(va.yaw,-d)),va.pitch=Math.min(d,Math.max(va.pitch,-d)),va.hfov=Math.min(d,Math.max(va.hfov,-d))),qa[0]&&qa[0]&&(va.hfov=0),(qa[2]||qa[6])&&(qa[3]||qa[7])&&(va.pitch=0),(qa[4]||qa[8])&&(qa[5]||qa[9])&&(va.yaw=0)}}function C(a){var b=za[a],c=Math.min(1,Math.max((Date.now()-b.startTime)/1e3/(b.duration/1e3),0)),c=b.startPosition+(.5>c?2*c*c:(4-2*c)*c-1)*(b.endPosition-b.startPosition);(b.endPosition>b.startPosition&&c>=b.endPosition||b.endPosition<b.startPosition&&c<=b.endPosition)&&(c=b.endPosition,va[a]=0,delete za[a]),aa[a]=c}function D(){S()}function E(){wa||(wa=!0,F())}function F(){if(G(),fa&&clearTimeout(fa),ja||xa)requestAnimationFrame(F);else if(qa[0]||qa[1]||qa[2]||qa[3]||qa[4]||qa[5]||qa[6]||qa[7]||qa[8]||qa[9]||aa.autoRotate||za.pitch||za.yaw||za.hfov||.01<Math.abs(va.yaw)||.01<Math.abs(va.pitch)||.01<Math.abs(va.hfov))B(),0<=aa.autoRotateInactivityDelay&&ya&&Date.now()-ka>aa.autoRotateInactivityDelay&&!aa.autoRotate&&(aa.autoRotate=ya,ia.lookAt(ha,c,ga,3e3)),requestAnimationFrame(F);else if(ba&&(ba.isLoading()||!0===aa.dynamic&&Ca))requestAnimationFrame(F);else{wa=!1,ea=c;var a=aa.autoRotateInactivityDelay-(Date.now()-ka);0<a?fa=setTimeout(function(){aa.autoRotate=ya,ia.lookAt(ha,c,ga,3e3),E()},a):0<=aa.autoRotateInactivityDelay&&ya&&(aa.autoRotate=ya,ia.lookAt(ha,c,ga,3e3),E())}}function G(){var a;if(sa){180<aa.yaw?aa.yaw-=360:-180>aa.yaw&&(aa.yaw+=360),a=aa.yaw;var b=aa.maxYaw-aa.minYaw,c=-180,d=180;360>b&&(c=aa.minYaw+aa.hfov/2,d=aa.maxYaw-aa.hfov/2,b<aa.hfov&&(c=d=(c+d)/2)),aa.yaw=Math.max(c,Math.min(d,aa.yaw)),!1!==aa.autoRotate&&a!=aa.yaw&&(aa.autoRotate*=-1),a=ba.getCanvas(),a=2*Math.atan(Math.tan(aa.hfov/180*Math.PI*.5)/(a.width/a.height))/Math.PI*180,b=aa.minPitch+a/2,c=aa.maxPitch-a/2,aa.maxPitch-aa.minPitch<a&&(b=c=(b+c)/2),isNaN(b)&&(b=-90),isNaN(c)&&(c=90),aa.pitch=Math.max(b,Math.min(c,aa.pitch)),ba.render(aa.pitch*Math.PI/180,aa.yaw*Math.PI/180,aa.hfov*Math.PI/180,{roll:aa.roll*Math.PI/180}),aa.hotSpots.forEach(O),aa.compass&&(La.style.transform="rotate("+(-aa.yaw-aa.northOffset)+"deg)",La.style.webkitTransform="rotate("+(-aa.yaw-aa.northOffset)+"deg)")}}function H(a,b,c,d){this.w=a,this.x=b,this.y=c,this.z=d}function I(b){var c;c=b.alpha;var d=b.beta;b=b.gamma,d=[d?d*Math.PI/180/2:0,b?b*Math.PI/180/2:0,c?c*Math.PI/180/2:0],c=[Math.cos(d[0]),Math.cos(d[1]),Math.cos(d[2])],d=[Math.sin(d[0]),Math.sin(d[1]),Math.sin(d[2])],c=new H(c[0]*c[1]*c[2]-d[0]*d[1]*d[2],d[0]*c[1]*c[2]-c[0]*d[1]*d[2],c[0]*d[1]*c[2]+d[0]*c[1]*d[2],c[0]*c[1]*d[2]+d[0]*d[1]*c[2]),c=c.multiply(new H(Math.sqrt(.5),-Math.sqrt(.5),0,0)),d=a.orientation?-a.orientation*Math.PI/180/2:0,c=c.multiply(new H(Math.cos(d),0,-Math.sin(d),0)).toEulerAngles(),aa.pitch=c[0]/Math.PI*180,aa.roll=-c[1]/Math.PI*180,aa.yaw=-c[2]/Math.PI*180+aa.northOffset}function J(){try{var a={};aa.horizonPitch!==c&&(a.horizonPitch=aa.horizonPitch*Math.PI/180),aa.horizonRoll!==c&&(a.horizonRoll=aa.horizonRoll*Math.PI/180),aa.backgroundColor!==c&&(a.backgroundColor=aa.backgroundColor),ba.init(da,aa.type,aa.dynamic,aa.haov*Math.PI/180,aa.vaov*Math.PI/180,aa.vOffset*Math.PI/180,K,a),!0!==aa.dynamic&&(da=c)}catch(a){if("webgl error"==a.type||"no webgl"==a.type)j();else{if("webgl size error"!=a.type)throw j("Unknown error. Check developer console."),a;j("This panorama is too big for your device! It's "+a.width+"px wide, but your device only supports images up to "+a.maxWidth+"px wide. Try another device. (If you're the author, try scaling down the image.)")}}}function K(){if(aa.sceneFadeDuration&&ba.fadeImg!==c){ba.fadeImg.style.opacity=0;var a=ba.fadeImg;delete ba.fadeImg,setTimeout(function(){Fa.removeChild(a)},aa.sceneFadeDuration)}La.style.display=aa.compass?"inline":"none",M(),Ia.load.box.style.display="none",ca!==c&&(Fa.removeChild(ca),ca=c),sa=!0,_("load"),E()}function L(a){a.pitch=Number(a.pitch)||0,a.yaw=Number(a.yaw)||0;var c=b.createElement("div");c.className="pnlm-hotspot-base",c.className=a.cssClass?c.className+" "+a.cssClass:c.className+" pnlm-hotspot pnlm-sprite pnlm-"+$(a.type);var d=b.createElement("span");a.text&&(d.innerHTML=$(a.text));var e;if(a.video){e=b.createElement("video");var f=a.video;aa.basePath&&!g(f)&&(f=aa.basePath+f),e.src=encodeURI(f),e.controls=!0,e.style.width=a.width+"px",Fa.appendChild(c),d.appendChild(e)}else if(a.image){f=a.image,aa.basePath&&!g(f)&&(f=aa.basePath+f),e=b.createElement("a"),e.href=encodeURI(a.URL?a.URL:f),e.target="_blank",d.appendChild(e);var h=b.createElement("img");h.src=encodeURI(f),h.style.width=a.width+"px",h.style.paddingTop="5px",Fa.appendChild(c),e.appendChild(h),d.style.maxWidth="initial"}else a.URL?(e=b.createElement("a"),e.href=encodeURI(a.URL),e.target="_blank",Fa.appendChild(e),c.style.cursor="pointer",d.style.cursor="pointer",e.appendChild(c)):(a.sceneId&&(c.onclick=function(){return X(a.sceneId,a.targetPitch,a.targetYaw,a.targetHfov),!1},c.ontouchend=function(){return X(a.sceneId,a.targetPitch,a.targetYaw,a.targetHfov),!1},c.style.cursor="pointer",d.style.cursor="pointer"),Fa.appendChild(c));a.createTooltipFunc?a.createTooltipFunc(c,a.createTooltipArgs):(a.text||a.video||a.image)&&(c.classList.add("pnlm-tooltip"),c.appendChild(d),d.style.width=d.scrollWidth-20+"px",d.style.marginLeft=-(d.scrollWidth-c.offsetWidth)/2+"px",d.style.marginTop=-d.scrollHeight-12+"px"),a.clickHandlerFunc&&(c.addEventListener("click",function(b){a.clickHandlerFunc(b,a.clickHandlerArgs)},"false"),c.style.cursor="pointer",d.style.cursor="pointer"),a.div=c}function M(){Da||(aa.hotSpots?(aa.hotSpots=aa.hotSpots.sort(function(a,b){return a.pitch<b.pitch}),aa.hotSpots.forEach(L)):aa.hotSpots=[],Da=!0,aa.hotSpots.forEach(O))}function N(){if(aa.hotSpots)for(var a=0;a<aa.hotSpots.length;a++){for(var b=aa.hotSpots[a].div;b.parentNode!=Fa;)b=b.parentNode;Fa.removeChild(b),delete aa.hotSpots[a].div}Da=!1,delete aa.hotSpots}function O(b){var c=Math.sin(b.pitch*Math.PI/180),d=Math.cos(b.pitch*Math.PI/180),e=Math.sin(aa.pitch*Math.PI/180),f=Math.cos(aa.pitch*Math.PI/180),g=Math.cos((-b.yaw+aa.yaw)*Math.PI/180),h=c*e+d*g*f;if(90>=b.yaw&&-90<b.yaw&&0>=h||(90<b.yaw||-90>=b.yaw)&&0>=h)b.div.style.visibility="hidden";else{var i=Math.sin((-b.yaw+aa.yaw)*Math.PI/180),j=Math.tan(aa.hfov*Math.PI/360);b.div.style.visibility="visible";var k=ba.getCanvas(),l=k.width/(a.devicePixelRatio||1),k=k.height/(a.devicePixelRatio||1),c=[-l/j*i*d/h/2,-l/j*(c*f-d*g*e)/h/2],d=Math.sin(aa.roll*Math.PI/180),e=Math.cos(aa.roll*Math.PI/180),c=[c[0]*e-c[1]*d,c[0]*d+c[1]*e];c[0]+=(l-b.div.offsetWidth)/2,c[1]+=(k-b.div.offsetHeight)/2,l="translate("+c[0]+"px, "+c[1]+"px) translateZ(9999px) rotate("+aa.roll+"deg)",b.div.style.webkitTransform=l,b.div.style.MozTransform=l,b.div.style.transform=l}}function P(a){aa={};var b,c="haov vaov vOffset northOffset horizonPitch horizonRoll".split(" ");Ba=[];for(b in Ea)Ea.hasOwnProperty(b)&&(aa[b]=Ea[b]);for(b in e.default)e.default.hasOwnProperty(b)&&(aa[b]=e.default[b],0<=c.indexOf(b)&&Ba.push(b));if(null!==a&&""!==a&&e.scenes&&e.scenes[a]){var d=e.scenes[a];for(b in d)d.hasOwnProperty(b)&&(aa[b]=d[b],0<=c.indexOf(b)&&Ba.push(b));aa.scene=a}for(b in e)e.hasOwnProperty(b)&&(aa[b]=e[b],0<=c.indexOf(b)&&Ba.push(b))}function Q(){if("preview"in aa){var a=aa.preview;aa.basePath&&(a=aa.basePath+a),ca=b.createElement("div"),ca.className="pnlm-preview-img",ca.style.backgroundImage="url('"+encodeURI(a)+"')",Fa.appendChild(ca)}aa.hasOwnProperty("title")||(Ia.title.innerHTML=""),aa.hasOwnProperty("author")||(Ia.author.innerHTML=""),aa.hasOwnProperty("title")||aa.hasOwnProperty("author")||(Ia.container.style.display="none");for(var d in aa)if(aa.hasOwnProperty(d))switch(d){case"title":Ia.title.innerHTML=$(aa[d]),Ia.container.style.display="inline";break;case"author":Ia.author.innerHTML="by "+$(aa[d]),Ia.container.style.display="inline";break;case"fallback":Ia.errorMsg.innerHTML='<p>Your browser does not support WebGL.<br><a href="'+encodeURI(aa[d])+'" target="_blank">Click here to view this panorama in an alternative viewer.</a></p>';break;case"hfov":U(Number(aa[d]));break;case"autoLoad":!0===aa[d]&&ba===c&&(Ia.load.box.style.display="inline",Ka.load.style.display="none",f());break;case"showZoomCtrl":Ka.zoom.style.display=aa[d]&&0!=aa.showControls?"block":"none";break;case"showFullscreenCtrl":Ka.fullscreen.style.display=aa[d]&&0!=aa.showControls&&("fullscreen"in b||"mozFullScreen"in b||"webkitIsFullScreen"in b||"msFullscreenElement"in b)?"block":"none";break;case"hotSpotDebug":Ja.style.display=aa[d]?"block":"none";break;case"showControls":aa[d]||(Ka.orientation.style.display="none",Ka.zoom.style.display="none",Ka.fullscreen.style.display="none");break;case"orientationOnByDefault":aa[d]&&Z()}}function R(){if(sa&&!ta)if(ra)b.exitFullscreen?b.exitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitCancelFullScreen?b.webkitCancelFullScreen():b.msExitFullscreen&&b.msExitFullscreen();else try{d.requestFullscreen?d.requestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.msRequestFullscreen?d.msRequestFullscreen():d.webkitRequestFullScreen()}catch(a){}}function S(){b.fullscreen||b.mozFullScreen||b.webkitIsFullScreen||b.msFullscreenElement?(Ka.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),ra=!0):(Ka.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),ra=!1),ba.resize(),U(aa.hfov),E()}function T(a){var b=aa.minHfov;return"multires"==aa.type&&ba&&(b=Math.min(b,ba.getCanvas().width/(aa.multiRes.cubeResolution/90*.9))),b>aa.maxHfov?(console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),aa.hfov):a<b?b:a>aa.maxHfov?aa.maxHfov:a}function U(a){aa.hfov=T(a)}function V(){za={},ya=aa.autoRotate?aa.autoRotate:ya,aa.autoRotate=!1}function W(){ta&&(Ia.load.box.style.display="none",Ia.errorMsg.style.display="none",ta=!1,_("errorcleared")),Ka.load.style.display="none",Ia.load.box.style.display="inline",f()}function X(a,b,d,f,g){sa=!1,za={};var h,i;aa.sceneFadeDuration&&!g?(g=new Image,g.className="pnlm-fade-img",g.style.transition="opacity "+aa.sceneFadeDuration/1e3+"s",g.style.width="100%",g.style.height="100%",g.onload=function(){X(a,b,d,f,!0)},h=ba.render(aa.pitch*Math.PI/180,aa.yaw*Math.PI/180,aa.hfov*Math.PI/180,{returnImage:!0}),h!==c&&(g.src=h),Fa.appendChild(g),ba.fadeImg=g):(g="same"===b?aa.pitch:b,h="same"===d?aa.yaw:"sameAzimuth"===d?aa.yaw+aa.northOffset-e.scenes[a].northOffset:d,i="same"===f?aa.hfov:f,N(),P(a),va.yaw=va.pitch=va.hfov=0,Q(),g!==c&&(aa.pitch=g),h!==c&&(aa.yaw=h),i!==c&&(aa.hfov=i),_("scenechange",a),W())}function Y(){a.removeEventListener("deviceorientation",I),Ka.orientation.classList.remove("pnlm-orientation-button-active"),xa=!1}function Z(){xa=!0,a.addEventListener("deviceorientation",I),Ka.orientation.classList.add("pnlm-orientation-button-active"),requestAnimationFrame(F)}function $(a){return String(a).replace(/&/g,"&amp;").replace('"',"&quot;").replace("'","&#39;").replace("<","&lt;").replace(">","&gt;").replace("/","&#x2f;")}function _(a){if(a in Aa)for(var b=0;b<Aa[a].length;b++)Aa[a][b].apply(null,[].slice.call(arguments,1))}var aa,ba,ca,da,ea,fa,ga,ha,ia=this,ja=!1,ka=Date.now(),la=0,ma=0,na=-1,oa=0,pa=0,qa=Array(10),ra=!1,sa=!1,ta=!1,ua=!1,va={yaw:0,pitch:0,hfov:0},wa=!1,xa=!1,ya=0,za={},Aa={},Ba=[],Ca=!1,Da=!1,Ea={hfov:100,minHfov:50,maxHfov:120,pitch:0,minPitch:c,maxPitch:c,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:c,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0]};d="string"==typeof d?b.getElementById(d):d,d.classList.add("pnlm-container"),d.tabIndex=0;var Fa=b.createElement("div");Fa.className="pnlm-render-container",d.appendChild(Fa);var Ga=b.createElement("div");Ga.className="pnlm-dragfix",d.appendChild(Ga);var Ha=b.createElement("span");d.appendChild(Ha),Ga.addEventListener("contextmenu",k);var Ia={},Ja=b.createElement("div");Ja.className="pnlm-sprite pnlm-hot-spot-debug-indicator",d.appendChild(Ja),Ia.container=b.createElement("div"),Ia.container.className="pnlm-panorama-info",Ia.title=b.createElement("div"),Ia.title.className="pnlm-title-box",Ia.container.appendChild(Ia.title),Ia.author=b.createElement("div"),Ia.author.className="pnlm-author-box",Ia.container.appendChild(Ia.author),d.appendChild(Ia.container),Ia.load={},Ia.load.box=b.createElement("div"),Ia.load.box.className="pnlm-load-box",Ia.load.box.innerHTML="<p>Loading...</p>",Ia.load.lbox=b.createElement("div"),Ia.load.lbox.className="pnlm-lbox",Ia.load.lbox.innerHTML='<div class="pnlm-loading"></div>',Ia.load.box.appendChild(Ia.load.lbox),Ia.load.lbar=b.createElement("div"),Ia.load.lbar.className="pnlm-lbar",Ia.load.lbarFill=b.createElement("div"),Ia.load.lbarFill.className="pnlm-lbar-fill",Ia.load.lbar.appendChild(Ia.load.lbarFill),Ia.load.box.appendChild(Ia.load.lbar),Ia.load.msg=b.createElement("p"),Ia.load.msg.className="pnlm-lmsg",Ia.load.box.appendChild(Ia.load.msg),d.appendChild(Ia.load.box),Ia.errorMsg=b.createElement("div"),Ia.errorMsg.className="pnlm-error-msg pnlm-info-box",d.appendChild(Ia.errorMsg);var Ka={};Ka.container=b.createElement("div"),Ka.container.className="pnlm-controls-container",d.appendChild(Ka.container),Ka.load=b.createElement("div"),Ka.load.className="pnlm-load-button",Ka.load.innerHTML="<p>Click to<br>Load<br>Panorama<p>",Ka.load.addEventListener("click",W),d.appendChild(Ka.load),Ka.zoom=b.createElement("div"),Ka.zoom.className="pnlm-zoom-controls pnlm-controls",Ka.zoomIn=b.createElement("div"),Ka.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",Ka.zoomIn.addEventListener("click",function(){sa&&(U(aa.hfov-5),E())}),Ka.zoom.appendChild(Ka.zoomIn),Ka.zoomOut=b.createElement("div"),Ka.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",Ka.zoomOut.addEventListener("click",function(){sa&&(U(aa.hfov+5),E())}),Ka.zoom.appendChild(Ka.zoomOut),Ka.container.appendChild(Ka.zoom),Ka.fullscreen=b.createElement("div"),Ka.fullscreen.addEventListener("click",R),Ka.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(b.fullscreenEnabled||b.mozFullScreenEnabled||b.webkitFullscreenEnabled||b.msFullscreenEnabled)&&Ka.container.appendChild(Ka.fullscreen),Ka.orientation=b.createElement("div"),Ka.orientation.addEventListener("click",function(a){xa?Y():Z()}),Ka.orientation.addEventListener("mousedown",function(a){a.stopPropagation()}),Ka.orientation.addEventListener("touchstart",function(a){a.stopPropagation()}),Ka.orientation.addEventListener("pointerdown",function(a){a.stopPropagation()}),Ka.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control",a.DeviceOrientationEvent&&a.addEventListener("deviceorientation",function(b){a.removeEventListener("deviceorientation",this),b&&null!==b.alpha&&null!==b.beta&&null!==b.gamma&&Ka.container.appendChild(Ka.orientation)});var La=b.createElement("div");La.className="pnlm-compass pnlm-controls pnlm-control",d.appendChild(La),P(e.firstScene?e.firstScene:e.default&&e.default.firstScene?e.default.firstScene:null),Q();var Ma=[],Na=[];H.prototype.multiply=function(a){return new H(this.w*a.w-this.x*a.x-this.y*a.y-this.z*a.z,this.x*a.w+this.w*a.x+this.y*a.z-this.z*a.y,this.y*a.w+this.w*a.y+this.z*a.x-this.x*a.z,this.z*a.w+this.w*a.z+this.x*a.y-this.y*a.x)},H.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.getPitch=function(){return aa.pitch},this.setPitch=function(a,b){return(b=b==c?1e3:Number(b))?za.pitch={startTime:Date.now(),startPosition:aa.pitch,endPosition:a,duration:b}:aa.pitch=a,E(),this},this.getPitchBounds=function(){return[aa.minPitch,aa.maxPitch]},this.setPitchBounds=function(a){return aa.minPitch=Math.max(-90,Math.min(a[0],90)),aa.maxPitch=Math.max(-90,Math.min(a[1],90)),this},this.getYaw=function(){return aa.yaw},this.setYaw=function(a,b){for(;180<a;)a-=360;for(;-180>a;)a+=360;return(b=b==c?1e3:Number(b))?za.yaw={startTime:Date.now(),startPosition:aa.yaw,endPosition:a,duration:b}:aa.yaw=a,E(),this},this.getYawBounds=function(){return[aa.minYaw,aa.maxYaw]},this.setYawBounds=function(a){return aa.minYaw=Math.max(-180,Math.min(a[0],180)),aa.maxYaw=Math.max(-180,Math.min(a[1],180)),this},this.getHfov=function(){return aa.hfov},this.setHfov=function(a,b){return(b=b==c?1e3:Number(b))?za.hfov={startTime:Date.now(),startPosition:aa.hfov,endPosition:T(a),duration:b}:U(a),E(),this},this.getHfovBounds=function(){return[aa.minHfov,aa.maxHfov]},this.setHfovBounds=function(a){return aa.minHfov=Math.max(0,a[0]),aa.maxHfov=Math.max(0,a[1]),this},this.lookAt=function(a,b,d,e){return e=e==c?1e3:Number(e),a!==c&&this.setPitch(a,e),b!==c&&this.setYaw(b,e),d!==c&&this.setHfov(d,e),this},this.getNorthOffset=function(){return aa.northOffset},this.setNorthOffset=function(a){return aa.northOffset=Math.min(360,Math.max(0,a)),E(),this},this.startAutoRotate=function(a){return a=a||ya||1,aa.autoRotate=a,ia.lookAt(ha,c,ga,3e3),E(),this},this.stopAutoRotate=function(){return ya=aa.autoRotate?aa.autoRotate:ya,aa.autoRotate=!1,aa.autoRotateInactivityDelay=-1,this},this.getRenderer=function(){return ba},this.setUpdate=function(a){return Ca=!0===a,ba===c?h():E(),this},this.mouseEventToCoords=function(a){return n(a)},this.loadScene=function(a,b,c,d){return sa&&X(a,b,c,d),this},this.getScene=function(){return aa.scene},this.addScene=function(a,b){return e.scenes[a]=b,this},this.removeScene=function(a){return!(aa.scene===a||!e.scenes.hasOwnProperty(a))&&(delete e.scenes[a],!0)},this.toggleFullscreen=function(){return R(),this},this.getConfig=function(){return aa},this.addHotSpot=function(a,b){if(b===c||aa.scene==b)L(a),aa.hotSpots.push(a),O(a);else{if(!e.scenes.hasOwnProperty(b))throw"Invalid scene ID!";e.scenes[b].hotSpots.push(a)}return this},this.removeHotSpot=function(a){if(!aa.hotSpots)return!1;for(var b=0;b<aa.hotSpots.length;b++)if(aa.hotSpots[b].hasOwnProperty("id")&&aa.hotSpots[b].id===a){for(a=aa.hotSpots[b].div;a.parentNode!=Fa;)a=a.parentNode;return Fa.removeChild(a),delete aa.hotSpots[b].div,aa.hotSpots.splice(b,1),!0}return!1},this.on=function(a,b){return Aa[a]=Aa[a]||[],Aa[a].push(b),this},this.off=function(a,b){if(!a)return Aa={},this;if(b){var c=Aa[a].indexOf(b);0<=c&&Aa[a].splice(c,1),Aa[a].length=0}else delete Aa[a];return this},this.destroy=function(){ba&&ba.destroy(),ua&&(Ga.removeEventListener("mousedown",m,!1),b.removeEventListener("mousemove",o,!1),b.removeEventListener("mouseup",p,!1),d.removeEventListener("mousewheel",w,!1),d.removeEventListener("DOMMouseScroll",w,!1),d.removeEventListener("mozfullscreenchange",S,!1),d.removeEventListener("webkitfullscreenchange",S,!1),d.removeEventListener("msfullscreenchange",S,!1),d.removeEventListener("fullscreenchange",S,!1),a.removeEventListener("resize",D,!1),a.removeEventListener("orientationchange",D,!1),d.removeEventListener("keydown",x,!1),d.removeEventListener("keyup",z,!1),d.removeEventListener("blur",y,!1),b.removeEventListener("mouseleave",p,!1),Ga.removeEventListener("touchstart",q,!1),Ga.removeEventListener("touchmove",r,!1),Ga.removeEventListener("touchend",s,!1),Ga.removeEventListener("pointerdown",t,!1),Ga.removeEventListener("pointermove",u,!1),Ga.removeEventListener("pointerup",v,!1),Ga.removeEventListener("pointerleave",v,!1)),d.innerHTML="",d.classList.remove("pnlm-container"),d.classList.remove("pnlm-grab"),d.classList.remove("pnlm-grabbing")}}return{viewer:function(a,b){return new d(a,b)}}}(window,document),function(){function a(a,c,d,e){return new b(a,c,d,e)}function b(a,b,d,e){this.options=e||{},this.options.adapters=this.options.adapters||{},this.obj=a,this.keypath=b,this.callback=d,this.objectPath=[],this.parse(),c(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function c(a){return"object"==typeof a&&null!==a}function d(a){throw new Error("[sightglass] "+a)}a.adapters={},b.tokenize=function(a,b,c){var d,e,f=[],g={i:c,path:""};for(d=0;d<a.length;d++)e=a.charAt(d),~b.indexOf(e)?(f.push(g),g={i:e,path:""}):g.path+=e;return f.push(g),f},b.prototype.parse=function(){var c,e,f=this.interfaces();f.length||d("Must define at least one adapter interface."),~f.indexOf(this.keypath[0])?(c=this.keypath[0],e=this.keypath.substr(1)):(void 0===(c=this.options.root||a.root)&&d("Must define a default root adapter."),e=this.keypath),this.tokens=b.tokenize(e,f,c),this.key=this.tokens.pop()},b.prototype.realize=function(){var a,b=this.obj,d=!1;return this.tokens.forEach(function(e,f){c(b)?(void 0!==this.objectPath[f]?b!==(a=this.objectPath[f])&&(this.set(!1,e,a,this.update.bind(this)),this.set(!0,e,b,this.update.bind(this)),this.objectPath[f]=b):(this.set(!0,e,b,this.update.bind(this)),this.objectPath[f]=b),b=this.get(e,b)):(!1===d&&(d=f),(a=this.objectPath[f])&&this.set(!1,e,a,this.update.bind(this)))},this),!1!==d&&this.objectPath.splice(d),b},b.prototype.update=function(){var a,b;(a=this.realize())!==this.target&&(c(this.target)&&this.set(!1,this.key,this.target,this.callback),c(a)&&this.set(!0,this.key,a,this.callback),b=this.value(),this.target=a,this.value()!==b&&this.callback())},b.prototype.value=function(){return c(this.target)?this.get(this.key,this.target):void 0},b.prototype.setValue=function(a){c(this.target)&&this.adapter(this.key).set(this.target,this.key.path,a)},b.prototype.get=function(a,b){return this.adapter(a).get(b,a.path)},b.prototype.set=function(a,b,c,d){var e=a?"observe":"unobserve";this.adapter(b)[e](c,b.path,d)},b.prototype.interfaces=function(){var b=Object.keys(this.options.adapters);return Object.keys(a.adapters).forEach(function(a){~b.indexOf(a)||b.push(a)}),b},b.prototype.adapter=function(b){return this.options.adapters[b.i]||a.adapters[b.i]},b.prototype.unobserve=function(){var a;this.tokens.forEach(function(b,c){(a=this.objectPath[c])&&this.set(!1,b,a,this.update.bind(this))},this),c(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=a}):this.sightglass=a}.call(this),function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].slice,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)},configure:function(b){var c,d,e,f;null==b&&(b={});for(e in b)if(f=b[e],"binders"===e||"components"===e||"formatters"===e||"adapters"===e)for(d in f)c=f[d],a[e][d]=c;else a.public[e]=f},bind:function(b,c,d){var e;return null==c&&(c={}),null==d&&(d={}),e=new a.View(b,c,d),e.bind(),e},init:function(b,c,d){var e,f;return null==d&&(d={}),null==c&&(c=document.createElement("div")),b=a.public.components[b],c.innerHTML=b.template.call(this,c),e=b.initialize.call(this,c,d),f=new a.View(c,e),f.bind(),f}}},window.jQuery||window.$?(d="on"in jQuery.prototype?["on","off"]:["bind","unbind"],b=d[0],c=d[1],a.Util={bindEvent:function(a,c,d){return jQuery(a)[b](c,d)},unbindEvent:function(a,b,d){return jQuery(a)[c](b,d)},getInputValue:function(a){var b;return b=jQuery(a),"checkbox"===b.attr("type")?b.is(":checked"):b.val()}}):a.Util={bindEvent:function(){return"addEventListener"in window?function(a,b,c){return a.addEventListener(b,c,!1)}:function(a,b,c){return a.attachEvent("on"+b,c)}}(),unbindEvent:function(){return"removeEventListener"in window?function(a,b,c){return a.removeEventListener(b,c,!1)}:function(a,b,c){return a.detachEvent("on"+b,c)}}(),getInputValue:function(a){var b,c,d,e;if("checkbox"===a.type)return a.checked;if("select-multiple"===a.type){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e}return a.value}},a.TypeParser=function(){function a(){}return a.types={primitive:0,keypath:1},a.parse=function(a){return/^'.*'$|^".*"$/.test(a)?{type:this.types.primitive,value:a.slice(1,-1)}:"true"===a?{type:this.types.primitive,value:!0}:"false"===a?{type:this.types.primitive,value:!1}:"null"===a?{type:this.types.primitive,value:null}:"undefined"===a?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(a))?{type:this.types.primitive,value:Number(a)}:{type:this.types.keypath,value:a}},a}(),a.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;f>d;){if(0>(c=a.indexOf(b[0],d))){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&c>d&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+b[0].length,0>(c=a.indexOf(b[1],d))){g=a.slice(d-b[1].length),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+b[1].length}return h},a}(),a.View=function(){function b(b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.els=b,this.models=c,null==d&&(d={}),this.update=e(this.update,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.select=e(this.select,this),this.traverse=e(this.traverse,this),this.build=e(this.build,this),this.buildBinding=e(this.buildBinding,this),this.bindingRegExp=e(this.bindingRegExp,this),this.options=e(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),n=a.extensions,j=0,l=n.length;l>j;j++){if(g=n[j],this[g]={},d[g]){o=d[g];for(f in o)h=o[f],this[g][f]=h}p=a.public[g];for(f in p)h=p[f],null==(i=this[g])[f]&&(i[f]=h)}for(q=a.options,k=0,m=q.length;m>k;k++)g=q[k],this[g]=null!=(r=d[g])?r:a.public[g];this.build()}return b.prototype.options=function(){var b,c,d,e,f;for(c={},f=a.extensions.concat(a.options),d=0,e=f.length;e>d;d++)b=f[d],c[b]=this[b];return c},b.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},b.prototype.buildBinding=function(b,c,d,e){var f,g,h,i,j,k,l;return j={},l=function(){var a,b,c,d;for(c=e.split("|"),d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(k.trim());return d}(),f=function(){var a,b,c,d;for(c=l.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push(g.trim());return d}(),i=f.shift(),j.formatters=l,(h=f.shift())&&(j.dependencies=h.split(/\s+/)),this.bindings.push(new a[b](this,c,d,i,j))},b.prototype.build=function(){var b,c,d,e,f;for(this.bindings=[],c=function(b){return function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(3===d.nodeType){if(i=a.TextTemplateParser,(g=b.templateDelimiters)&&(l=i.parse(d.data,g)).length&&(1!==l.length||l[0].type!==i.types.text)){for(m=0,o=l.length;o>m;m++)k=l[m],j=document.createTextNode(k.value),d.parentNode.insertBefore(j,d),1===k.type&&b.buildBinding("TextBinding",j,null,k.value);d.parentNode.removeChild(d)}}else 1===d.nodeType&&(e=b.traverse(d));if(!e){for(q=function(){var a,b,c,e;for(c=d.childNodes,e=[],a=0,b=c.length;b>a;a++)h=c[a],e.push(h);return e}(),r=[],n=0,p=q.length;p>n;n++)f=q[n],r.push(c(f));return r}}}(this),f=this.els,d=0,e=f.length;e>d;d++)b=f[d],c(b);this.bindings.sort(function(a,b){var c,d;return((null!=(c=b.binder)?c.priority:void 0)||0)-((null!=(d=a.binder)?d.priority:void 0)||0)})},b.prototype.traverse=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(f=this.bindingRegExp(),g="SCRIPT"===b.nodeName||"STYLE"===b.nodeName,p=b.attributes,l=0,n=p.length;n>l;l++)if(c=p[l],f.test(c.name)){if(j=c.name.replace(f,""),!(e=this.binders[j])){q=this.binders;for(h in q)k=q[h],"*"!==h&&-1!==h.indexOf("*")&&(i=new RegExp("^"+h.replace(/\*/g,".+")+"$"),i.test(j)&&(e=k))}e||(e=this.binders["*"]),e.block&&(g=!0,d=[c])}for(r=d||b.attributes,m=0,o=r.length;o>m;m++)c=r[m],f.test(c.name)&&(j=c.name.replace(f,""),this.buildBinding("Binding",b,j,c.value));return g||(j=b.nodeName.toLowerCase(),this.components[j]&&!b._bound&&(this.bindings.push(new a.ComponentBinding(this,b,j)),g=!0)),g},b.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},b.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},b.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},b.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push("function"==typeof a.sync?a.sync():void 0);return e},b.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){var b;return null!=(b=a.binder)?b.publishes:void 0}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},b.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push("function"==typeof b.update?b.update(a):void 0);return h},b}(),a.Binding=function(){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.getValue=e(this.getValue,this),this.update=e(this.update,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.set=e(this.set,this),this.eventHandler=e(this.eventHandler,this),this.formattedValue=e(this.formattedValue,this),this.parseTarget=e(this.parseTarget,this),this.observe=e(this.observe,this),this.setBinder=e(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return b.prototype.setBinder=function(){var a,b,c,d;if(!(this.binder=this.view.binders[this.type])){d=this.view.binders;for(a in d)c=d[a],"*"!==a&&-1!==a.indexOf("*")&&(b=new RegExp("^"+a.replace(/\*/g,".+")+"$"),b.test(this.type)&&(this.binder=c,this.args=new RegExp("^"+a.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},b.prototype.observe=function(b,c,d){return a.sightglass(b,c,d,{root:this.view.rootInterface,adapters:this.view.adapters})},b.prototype.parseTarget=function(){var b;return b=a.TypeParser.parse(this.keypath),0===b.type?this.value=b.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},b.prototype.formattedValue=function(b){var c,d,e,g,h,i,j,k,l,m,n,o,p,q;for(q=this.formatters,g=m=0,o=q.length;o>m;g=++m){for(h=q[g],e=h.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),i=e.shift(),h=this.view.formatters[i],e=function(){var b,c,f;for(f=[],b=0,c=e.length;c>b;b++)d=e[b],f.push(a.TypeParser.parse(d));return f}(),k=[],c=n=0,p=e.length;p>n;c=++n)d=e[c],k.push(0===d.type?d.value:((l=this.formatterObservers)[g]||(l[g]={}),(j=this.formatterObservers[g][c])||(j=this.observe(this.view.models,d.value,this.sync),this.formatterObservers[g][c]=j),j.value()));(null!=h?h.read:void 0)instanceof Function?b=h.read.apply(h,[b].concat(f.call(k))):h instanceof Function&&(b=h.apply(null,[b].concat(f.call(k))))}return b},b.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.handler,function(d){return c.call(a,this,d,b)}},b.prototype.set=function(a){var b;return a=this.formattedValue(a instanceof Function&&!this.binder.function?a.call(this.model):a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},b.prototype.sync=function(){var a,b;return this.set(function(){var c,d,e,f,g,h,i;if(this.observer){if(this.model!==this.observer.target){for(g=this.dependencies,c=0,e=g.length;e>c;c++)b=g[c],b.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(h=this.options.dependencies)?h.length:void 0))for(i=this.options.dependencies,d=0,f=i.length;f>d;d++)a=i[d],b=this.observe(this.model,a,this.sync),this.dependencies.push(b)}return this.observer.value()}return this.value}.call(this))},b.prototype.publish=function(){var a,b,c,d,e,g,h,i,j;if(this.observer){for(d=this.getValue(this.el),h=this.formatters.slice(0).reverse(),e=0,g=h.length;g>e;e++)b=h[e],a=b.split(/\s+/),c=a.shift(),(null!=(i=this.view.formatters[c])?i.publish:void 0)&&(d=(j=this.view.formatters[c]).publish.apply(j,[d].concat(f.call(a))));return this.observer.setValue(d)}},b.prototype.bind=function(){var a,b,c,d,e,f,g;if(this.parseTarget(),null!=(e=this.binder.bind)&&e.call(this,this.el),null!=this.model&&(null!=(f=this.options.dependencies)?f.length:void 0))for(g=this.options.dependencies,c=0,d=g.length;d>c;c++)a=g[c],b=this.observe(this.model,a,this.sync),this.dependencies.push(b);return this.view.preloadData?this.sync():void 0},b.prototype.unbind=function(){var a,b,c,d,e,f,g,h,i,j;for(null!=(g=this.binder.unbind)&&g.call(this,this.el),null!=(h=this.observer)&&h.unobserve(),i=this.dependencies,e=0,f=i.length;f>e;e++)d=i[e],d.unobserve();this.dependencies=[],j=this.formatterObservers;for(c in j){b=j[c];for(a in b)d=b[a],d.unobserve()}return this.formatterObservers={}},b.prototype.update=function(a){var b,c;return null==a&&(a={}),this.model=null!=(b=this.observer)?b.target:void 0,null!=(c=this.binder.update)?c.call(this,a):void 0},b.prototype.getValue=function(b){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,b):a.Util.getInputValue(b)},b}(),a.ComponentBinding=function(b){function c(a,b,c){var d,f,g,h,j,k,l;for(this.view=a,this.el=b,this.type=c,this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.locals=e(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},f=a.bindingRegExp(),k=this.el.attributes||[],h=0,j=k.length;j>h;h++)d=k[h],f.test(d.name)||(g=this.camelCase(d.name),i.call(null!=(l=this.component.static)?l:[],g)>=0?this.static[g]=d.value:this.observers[g]=d.value)}return h(c,b),c.prototype.sync=function(){},c.prototype.update=function(){},c.prototype.publish=function(){},c.prototype.locals=function(){var a,b,c,d,e,f;c={},e=this.static;for(a in e)d=e[a],c[a]=d;f=this.observers;for(a in f)b=f[a],c[a]=b.value();return c},c.prototype.camelCase=function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},c.prototype.bind=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(!this.bound){o=this.observers;for(c in o)d=o[c],this.observers[c]=this.observe(this.view.models,d,function(a){return function(b){return function(){return a.componentView.models[b]=a.observers[b].value()}}}(this).call(this,c));this.bound=!0}if(null!=this.componentView)return this.componentView.bind();for(this.el.innerHTML=this.component.template.call(this),h=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,g={},p=a.extensions,k=0,m=p.length;m>k;k++){if(f=p[k],g[f]={},this.component[f]){q=this.component[f];for(b in q)i=q[b],g[f][b]=i}r=this.view[f];for(b in r)i=r[b],null==(j=g[f])[b]&&(j[b]=i)}for(s=a.options,l=0,n=s.length;n>l;l++)f=s[l],g[f]=null!=(t=this.component[f])?t:this.view[f];this.componentView=new a.View(this.el,h,g),this.componentView.bind(),u=this.observers,v=[];for(c in u)e=u[c],v.push(this.upstreamObservers[c]=this.observe(this.componentView.models,c,function(a){return function(b,c){return function(){return c.setValue(a.componentView.models[b])}}}(this).call(this,c,e)));return v},c.prototype.unbind=function(){var a,b,c,d,e;c=this.upstreamObservers;for(a in c)b=c[a],b.unobserve();d=this.observers;for(a in d)b=d[a],b.unobserve();return null!=(e=this.componentView)?e.unbind.call(this):void 0},c}(a.Binding),a.TextBinding=function(a){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.sync=e(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return h(b,a),b.prototype.binder={routine:function(a,b){return a.data=null!=b?b:""}},b.prototype.sync=function(){return b.__super__.sync.apply(this,arguments)},b}(a.Binding),a.public.binders.text=function(a,b){return null!=a.textContent?a.textContent=null!=b?b:"":a.innerText=null!=b?b:""},a.public.binders.html=function(a,b){return a.innerHTML=null!=b?b:""},a.public.binders.show=function(a,b){return a.style.display=b?"":"none"},a.public.binders.hide=function(a,b){return a.style.display=b?"none":""},a.public.binders.enabled=function(a,b){return a.disabled=!b},a.public.binders.disabled=function(a,b){return a.disabled=!!b},a.public.binders.checked={publishes:!0,priority:2e3,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},a.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},a.public.binders.value={publishes:!0,priority:3e3,bind:function(b){return"INPUT"!==b.tagName||"radio"!==b.type?(this.event="SELECT"===b.tagName?"change":"input",a.Util.bindEvent(b,this.event,this.publish)):void 0},unbind:function(b){return"INPUT"!==b.tagName||"radio"!==b.type?a.Util.unbindEvent(b,this.event,this.publish):void 0},routine:function(a,b){var c,d,e,f,g,h,j;if("INPUT"===a.tagName&&"radio"===a.type)return a.setAttribute("value",b);if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(f=a.val())?f.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(j=[],d=0,e=a.length;e>d;d++)c=a[d],j.push(c.selected=(g=c.value,i.call(b,g)>=0));return j}}else if((null!=b?b.toString():void 0)!==(null!=(h=a.value)?h.toString():void 0))return a.value=null!=b?b:""}},a.public.binders.if={block:!0,priority:4e3,bind:function(a){var b,c;return null==this.marker?(b=[this.view.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),this.bound=!1,a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(b,c){var d,e,f,g;if(!!c==!this.bound){if(c){f={},g=this.view.models;for(d in g)e=g[d],f[d]=e;return(this.nested||(this.nested=new a.View(b,f,this.view.options()))).bind(),this.marker.parentNode.insertBefore(b,this.marker.nextSibling),this.bound=!0}return b.parentNode.removeChild(b),this.nested.unbind(),this.bound=!1}},update:function(a){var b;return null!=(b=this.nested)?b.update(a):void 0}},a.public.binders.unless={block:!0,priority:4e3,bind:function(b){return a.public.binders.if.bind.call(this,b)},unbind:function(){return a.public.binders.if.unbind.call(this)},routine:function(b,c){return a.public.binders.if.routine.call(this,b,!c)},update:function(b){return a.public.binders.if.update.call(this,b)}},a.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(b){return this.handler?a.Util.unbindEvent(b,this.args[0],this.handler):void 0},routine:function(b,c){return this.handler&&a.Util.unbindEvent(b,this.args[0],this.handler),a.Util.bindEvent(b,this.args[0],this.handler=this.eventHandler(c))}},a.public.binders["each-*"]={block:!0,priority:4e3,bind:function(a){var b,c,d,e,f;if(null==this.marker)b=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a);else for(f=this.iterated,d=0,e=f.length;e>d;d++)c=f[d],c.bind()},unbind:function(){var a,b,c,d,e;if(null!=this.iterated){for(d=this.iterated,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e}},routine:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(i=this.args[0],c=c||[],this.iterated.length>c.length)for(t=Array(this.iterated.length-c.length),n=0,q=t.length;q>n;n++)t[n],m=this.iterated.pop(),m.unbind(),this.marker.parentNode.removeChild(m.els[0]);for(f=o=0,r=c.length;r>o;f=++o)if(h=c[f],e={index:f},e[i]=h,null==this.iterated[f]){u=this.view.models;for(g in u)h=u[g],null==e[g]&&(e[g]=h);k=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,j=this.view.options(),j.preloadData=!0,l=b.cloneNode(!0),m=new a.View(l,e,j),m.bind(),this.iterated.push(m),this.marker.parentNode.insertBefore(l,k.nextSibling)}else this.iterated[f].models[i]!==h&&this.iterated[f].update(e);if("OPTION"===b.nodeName){for(v=this.view.bindings,w=[],p=0,s=v.length;s>p;p++)d=v[p],w.push(d.el===this.marker.parentNode&&"value"===d.type?d.sync():void 0);return w}},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},a.public.binders["class-*"]=function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},a.public.binders["*"]=function(a,b){return null!=b?a.setAttribute(this.type,b):a.removeAttribute(this.type)},a.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(a){var b,c,d;return a.hasOwnProperty(this.id)||(b=this.counter++,Object.defineProperty(a,this.id,{value:b})),(c=this.weakmap)[d=a[this.id]]||(c[d]={callbacks:{}})},cleanupWeakReference:function(a,b){return Object.keys(a.callbacks).length||a.pointers&&Object.keys(a.pointers).length?void 0:delete this.weakmap[b]},stubFunction:function(a,b){var c,d,e;return d=a[b],c=this.weakReference(a),e=this.weakmap,a[b]=function(){var b,f,g,h,i,j,k,l,m;g=d.apply(a,arguments),j=c.pointers;for(f in j)for(b=j[f],m=null!=(k=null!=(l=e[f])?l.callbacks[b]:void 0)?k:[],h=0,i=m.length;i>h;h++)(0,m[h])();return g}},observeMutations:function(a,b,c){var d,e,f,g,h,j;if(Array.isArray(a)){if(f=this.weakReference(a),null==f.pointers)for(f.pointers={},e=["push","pop","shift","unshift","sort","reverse","splice"],h=0,j=e.length;j>h;h++)d=e[h],this.stubFunction(a,d);if(null==(g=f.pointers)[b]&&(g[b]=[]),i.call(f.pointers[b],c)<0)return f.pointers[b].push(c)}},unobserveMutations:function(a,b,c){var d,e,f;return Array.isArray(a)&&null!=a[this.id]&&(e=this.weakmap[a[this.id]])&&(f=e.pointers[b])?((d=f.indexOf(c))>=0&&f.splice(d,1),f.length||delete e.pointers[b],this.cleanupWeakReference(e,a[this.id])):void 0},observe:function(a,b,c){var d,e,f;return d=this.weakReference(a).callbacks,null==d[b]&&(d[b]=[],e=Object.getOwnPropertyDescriptor(a,b),(null!=e?e.get:void 0)||(null!=e?e.set:void 0)||(f=a[b],Object.defineProperty(a,b,{enumerable:!0,get:function(){return f},set:function(e){return function(g){var h,j,k,l;if(g!==f&&(e.unobserveMutations(f,a[e.id],b),f=g,h=e.weakmap[a[e.id]])){if(d=h.callbacks,d[b])for(l=d[b].slice(),j=0,k=l.length;k>j;j++)c=l[j],i.call(d[b],c)>=0&&c();return e.observeMutations(g,a[e.id],b)}}}(this)}))),i.call(d[b],c)<0&&d[b].push(c),this.observeMutations(a[b],a[this.id],b)},unobserve:function(a,b,c){var d,e,f;return(f=this.weakmap[a[this.id]])&&(d=f.callbacks[b])?((e=d.indexOf(c))>=0&&(d.splice(e,1),d.length||delete f.callbacks[b]),this.unobserveMutations(a[b],a[this.id],b),this.cleanupWeakReference(f,a[this.id])):void 0},get:function(a,b){return a[b]},set:function(a,b,c){return a[b]=c}},a.factory=function(b){return a.sightglass=b,a.public._=a,a.public},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=a.factory(require("sightglass")):"function"==typeof define&&define.amd?define(["sightglass"],function(b){return this.rivets=a.factory(b)}):this.rivets=a.factory(sightglass)}.call(this),function(){var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}};b=function(){function a(){this.update=g(this.update,this)}return a.prototype.update=function(a){var b,c,e;for(c in a)e=a[c],"items"!==c&&(this[c]=e);return this.items=function(){var c,e,f,g;for(f=a.items,g=[],c=0,e=f.length;e>c;c++)b=f[c],g.push(new d(b));return g}()},a}(),d=function(){function a(a){this.propertyArray=g(this.propertyArray,this),this.update=g(this.update,this),this.update(a)}return a.prototype.update=function(a){var b,d;for(b in a)d=a[b],"properties"!==b&&(this[b]=d);return this.properties=c.Utils.extend({},a.properties)},a.prototype.propertyArray=function(){var a,b,c,d;c=this.properties,d=[];for(a in c)b=c[a],d.push({name:a,value:b});return d},a}(),c={settings:{debug:!1,dataAPI:!0,requestBodyClass:null,rivetsModels:{},currency:null,moneyFormat:null,moneyWithCurrencyFormat:null,weightUnit:"g",weightPrecision:0},cart:new b},c.init=function(a,b){return null==b&&(b={}),c.configure(b),c.Utils.log("Initialising CartJS."),c.cart.update(a),c.settings.dataAPI&&(c.Utils.log('"dataAPI" setting is true, initialising Data API.'),c.Data.init()),c.settings.requestBodyClass&&(c.Utils.log('"requestBodyClass" set, adding event listeners.'),jQuery(document).on("cart.requestStarted",function(){return jQuery("body").addClass(c.settings.requestBodyClass)}),jQuery(document).on("cart.requestComplete",function(){return jQuery("body").removeClass(c.settings.requestBodyClass)})),c.Rivets.init(),jQuery(document).trigger("cart.ready",[c.cart])},c.configure=function(a){return null==a&&(a={}),c.Utils.extend(c.settings,a)},null==window.console&&(window.console={},window.console.log=function(){}),c.Utils={log:function(){return c.Utils.console(console.log,arguments)},error:function(){return c.Utils.console(console.error,arguments)},console:function(a,b){return c.settings.debug&&"undefined"!=typeof console&&null!==console?(b=Array.prototype.slice.call(b),b.unshift("[CartJS]:"),a.apply(console,b)):void 0},wrapKeys:function(a,b,c){var d,e,f;null==b&&(b="properties"),f={};for(d in a)e=a[d],f[b+"["+d+"]"]=null!=c?c:e;return f},unwrapKeys:function(a,b,c){var d,e,f,g;null==b&&(b="properties"),e={};for(d in a)g=a[d],f=d.replace(b+"[","").replace("]",""),e[f]=null!=c?c:g;return e},extend:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},clone:function(a){var b,c;if(null==a||"object"!=typeof a)return a;c=new a.constructor;for(b in a)c[b]=clone(a[b]);return c},isArray:Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},ensureArray:function(a){return c.Utils.isArray(a)?a:null!=a?[a]:[]},formatMoney:function(a,b,d,e){var f,g;return null==e&&(e=""),e||(e=c.settings.currency),null!=window.Currency&&e!==c.settings.currency&&(a=Currency.convert(a,c.settings.currency,e),null!=(null!=(f=window.Currency)?f.moneyFormats:void 0)&&e in window.Currency.moneyFormats&&(b=window.Currency.moneyFormats[e][d])),null!=(null!=(g=window.Shopify)?g.formatMoney:void 0)?Shopify.formatMoney(a,b):a},getSizedImageUrl:function(a,b){var c,d;return null!=(null!=(c=window.Shopify)&&null!=(d=c.Image)?d.getSizedImageUrl:void 0)?a?Shopify.Image.getSizedImageUrl(a,b):Shopify.Image.getSizedImageUrl("https://cdn.shopify.com/s/images/admin/no-image-.gif",b).replace("-_","-"):a||"https://cdn.shopify.com/s/images/admin/no-image-large.gif"}},f=[],e=!1,c.Queue={add:function(a,b,d){var g;return null==d&&(d={}),g={url:a,data:b,type:d.type||"POST",dataType:d.dataType||"json",success:c.Utils.ensureArray(d.success),error:c.Utils.ensureArray(d.error),complete:c.Utils.ensureArray(d.complete)},d.updateCart&&g.success.push(c.cart.update),f.push(g),e?void 0:(jQuery(document).trigger("cart.requestStarted",[c.cart]),c.Queue.process())},process:function(){var a;return f.length?(e=!0,a=f.shift(),a.complete=c.Queue.process,jQuery.ajax(a)):(e=!1,void jQuery(document).trigger("cart.requestComplete",[c.cart]))}},c.Core={getCart:function(a){return null==a&&(a={}),a.type="GET",a.updateCart=!0,c.Queue.add("/cart.js",{},a)},addItem:function(a,b,d,e){var f;return null==b&&(b=1),null==d&&(d={}),null==e&&(e={}),f=c.Utils.wrapKeys(d),f.id=a,f.quantity=b,c.Queue.add("/cart/add.js",f,e),c.Core.getCart()},updateItem:function(a,b,d,e){var f;return null==d&&(d={}),null==e&&(e={}),f=c.Utils.wrapKeys(d),f.line=a,null!=b&&(f.quantity=b),e.updateCart=!0,c.Queue.add("/cart/change.js",f,e)},removeItem:function(a,b){return null==b&&(b={}),c.Core.updateItem(a,0,{},b)},updateItemById:function(a,b,d,e){var f;return null==d&&(d={}),null==e&&(e={}),f=c.Utils.wrapKeys(d),f.id=a,null!=b&&(f.quantity=b),e.updateCart=!0,c.Queue.add("/cart/change.js",f,e)},updateItemQuantitiesById:function(a,b){return null==a&&(a={}),null==b&&(b={}),b.updateCart=!0,c.Queue.add("/cart/update.js",{updates:a},b)},removeItemById:function(a,b){var d;return null==b&&(b={}),d={id:a,quantity:0},b.updateCart=!0,c.Queue.add("/cart/change.js",d,b)},clear:function(a){return null==a&&(a={}),a.updateCart=!0,c.Queue.add("/cart/clear.js",{},a)},getAttribute:function(a,b){return a in c.cart.attributes?c.cart.attributes[a]:b},setAttribute:function(a,b,d){var e;return null==d&&(d={}),e={},e[a]=b,c.Core.setAttributes(e,d)},getAttributes:function(){return c.cart.attributes},setAttributes:function(a,b){return null==a&&(a={}),null==b&&(b={}),b.updateCart=!0,c.Queue.add("/cart/update.js",c.Utils.wrapKeys(a,"attributes"),b)},clearAttributes:function(a){return null==a&&(a={}),a.updateCart=!0,c.Queue.add("/cart/update.js",c.Utils.wrapKeys(c.Core.getAttributes(),"attributes",""),a)},getNote:function(){return c.cart.note},setNote:function(a,b){return null==b&&(b={}),b.updateCart=!0,c.Queue.add("/cart/update.js",{note:a},b)}},a=null,c.Data={init:function(){return a=jQuery(document),c.Data.setEventListeners("on"),c.Data.render(null,c.cart)},destroy:function(){return c.Data.setEventListeners("off")},setEventListeners:function(b){return a[b]("click","[data-cart-add]",c.Data.add),a[b]("click","[data-cart-remove]",c.Data.remove),a[b]("click","[data-cart-remove-id]",c.Data.removeById),a[b]("click","[data-cart-update]",c.Data.update),a[b]("click","[data-cart-update-id]",c.Data.updateById),a[b]("click","[data-cart-clear]",c.Data.clear),a[b]("change","[data-cart-toggle]",c.Data.toggle),a[b]("change","[data-cart-toggle-attribute]",c.Data.toggleAttribute),a[b]("submit","[data-cart-submit]",c.Data.submit),a[b]("cart.requestComplete",c.Data.render)},add:function(a){var b;return a.preventDefault(),b=jQuery(this),c.Core.addItem(b.attr("data-cart-add"),b.attr("data-cart-quantity"))},remove:function(a){var b;return a.preventDefault(),b=jQuery(this),c.Core.removeItem(b.attr("data-cart-remove"))},removeById:function(a){var b;return a.preventDefault(),b=jQuery(this),c.Core.removeItemById(b.attr("data-cart-remove-id"))},update:function(a){var b;return a.preventDefault(),b=jQuery(this),c.Core.updateItem(b.attr("data-cart-update"),b.attr("data-cart-quantity"))},updateById:function(a){var b;return a.preventDefault(),b=jQuery(this),c.Core.updateItemById(b.attr("data-cart-update-id"),b.attr("data-cart-quantity"))},clear:function(a){return a.preventDefault(),c.Core.clear()},toggle:function(){var a,b;return a=jQuery(this),b=a.attr("data-cart-toggle"),a.is(":checked")?c.Core.addItem(b):c.Core.removeItemById(b)},toggleAttribute:function(){var a,b;return a=jQuery(this),b=a.attr("data-cart-toggle-attribute"),c.Core.setAttribute(b,a.is(":checked")?"Yes":"")},submit:function(a){var b,d,e,f;return a.preventDefault(),b=jQuery(this).serializeArray(),d=void 0,f=void 0,e={},jQuery.each(b,function(a,b){return"id"===b.name?d=b.value:"quantity"===b.name?f=b.value:b.name.match(/^properties\[\w+\]$/)?e[b.name]=b.value:void 0}),c.Core.addItem(d,f,c.Utils.unwrapKeys(e))},render:function(a,b){var d;return d={item_count:b.item_count,total_price:b.total_price,total_price_money:c.Utils.formatMoney(b.total_price,c.settings.moneyFormat,"money_format",null!=("undefined"!=typeof Currency&&null!==Currency?Currency.currentCurrency:void 0)?Currency.currentCurrency:void 0),total_price_money_with_currency:c.Utils.formatMoney(b.total_price,c.settings.moneyWithCurrencyFormat,"money_with_currency_format",null!=("undefined"!=typeof Currency&&null!==Currency?Currency.currentCurrency:void 0)?Currency.currentCurrency:void 0)},jQuery("[data-cart-render]").each(function(){var a;return a=jQuery(this),a.html(d[a.attr("data-cart-render")])})}},"rivets"in window?(c.Rivets={model:null,boundViews:[],init:function(){return c.Rivets.bindViews()},destroy:function(){return c.Rivets.unbindViews()},bindViews:function(){return c.Utils.log("Rivets.js is present, binding views."),c.Rivets.unbindViews(),c.Rivets.model=c.Utils.extend({cart:c.cart},c.settings.rivetsModels),null!=window.Currency&&(c.Rivets.model.Currency=window.Currency),jQuery("[data-cart-view]").each(function(){var a;return a=rivets.bind(jQuery(this),c.Rivets.model),c.Rivets.boundViews.push(a)})},unbindViews:function(){var a,b,d,e;for(e=c.Rivets.boundViews,b=0,d=e.length;d>b;b++)a=e[b],a.unbind();return c.Rivets.boundViews=[]}},rivets.formatters.eq=function(a,b){return a===b},rivets.formatters.includes=function(a,b){return a.indexOf(b)>=0},rivets.formatters.match=function(a,b,c){return a.match(new RegExp(b,c))},rivets.formatters.lt=function(a,b){return b>a},rivets.formatters.gt=function(a,b){return a>b},rivets.formatters.not=function(a){return!a},rivets.formatters.empty=function(a){return!a.length},rivets.formatters.plus=function(a,b){return parseInt(a)+parseInt(b)},rivets.formatters.minus=function(a,b){return parseInt(a)-parseInt(b)},rivets.formatters.times=function(a,b){return a*b},rivets.formatters.divided_by=function(a,b){return a/b},rivets.formatters.modulo=function(a,b){return a%b},rivets.formatters.prepend=function(a,b){return b+a},rivets.formatters.append=function(a,b){return a+b},rivets.formatters.slice=function(a,b,c){return a.slice(b,c)},rivets.formatters.pluralize=function(a,b,d){return null==d&&(d=b+"s"),c.Utils.isArray(a)&&(a=a.length),1===a?b:d},rivets.formatters.array_element=function(a,b){return a[b]},rivets.formatters.array_first=function(a){return a[0]},rivets.formatters.array_last=function(a){return a[a.length-1]},rivets.formatters.money=function(a,b){return c.Utils.formatMoney(a,c.settings.moneyFormat,"money_format",b)},rivets.formatters.money_with_currency=function(a,b){return c.Utils.formatMoney(a,c.settings.moneyWithCurrencyFormat,"money_with_currency_format",b)},rivets.formatters.weight=function(a){switch(c.settings.weightUnit){case"kg":return(a/1e3).toFixed(c.settings.weightPrecision);case"oz":return(.035274*a).toFixed(c.settings.weightPrecision);case"lb":return(.00220462*a).toFixed(c.settings.weightPrecision);default:return a.toFixed(c.settings.weightPrecision)}},rivets.formatters.weight_with_unit=function(a){return rivets.formatters.weight(a)+c.settings.weightUnit},rivets.formatters.product_image_size=function(a,b){return c.Utils.getSizedImageUrl(a,b)},rivets.formatters.moneyWithCurrency=rivets.formatters.money_with_currency,rivets.formatters.weightWithUnit=rivets.formatters.weight_with_unit,rivets.formatters.productImageSize=rivets.formatters.product_image_size):c.Rivets={init:function(){},destroy:function(){}},c.factory=function(a){return a.init=c.init,a.configure=c.configure,a.cart=c.cart,a.settings=c.settings,a.getCart=c.Core.getCart,a.addItem=c.Core.addItem,a.updateItem=c.Core.updateItem,a.updateItemById=c.Core.updateItemById,a.updateItemQuantitiesById=c.Core.updateItemQuantitiesById,a.removeItem=c.Core.removeItem,a.removeItemById=c.Core.removeItemById,a.clear=c.Core.clear,a.getAttribute=c.Core.getAttribute,a.setAttribute=c.Core.setAttribute,a.getAttributes=c.Core.getAttributes,a.setAttributes=c.Core.setAttributes,a.clearAttributes=c.Core.clearAttributes,a.getNote=c.Core.getNote,a.setNote=c.Core.setNote,a.render=c.Data.render},"object"==typeof exports?c.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(a){return c.factory(this.CartJS=a),a}):c.factory(this.CartJS={})}.call(this),$(document).ready(function(){$(".menu-btn").click(function(){$("#slide-out").toggleClass("closed"),$(".panorama-wrapper").toggleClass("sidenav-closed")})});
